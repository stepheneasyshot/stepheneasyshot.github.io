---
layout: post
description: > 
  本文介绍了Java项目开发中最常见的几种设计模式
image: 
  path: /assets/img/blog/blogs_git_logo.png
  srcset: 
    1920w: /assets/img/blog/blogs_git_logo.png
    960w:  /assets/img/blog/blogs_git_logo.png
    480w:  /assets/img/blog/blogs_git_logo.png
accent_image: /assets/img/blog/blogs_git_logo.png
excerpt_separator: <!--more-->
sitemap: false
---
# Git基础与进阶
Git的本地部分主要有几个区域：
![git_status](/assets/img/blog/blogs_git_flow.png){:width="600" height = "300" loading="lazy"}
区域的含义：
* 工作区域（Working Directory）就是你平时存放项目代码的地方。
* 暂存区域（Stage）用于临时存放你的改动，事实上它只是一个文件，保存即将提交的文件列表信息。
* Git 仓库（Repository）就是安全存放数据的位置，这里边有你提交的所有版本的数据。其中，HEAD 指向最新放入仓库的版本（这第三棵树，确切的说，应该是 Git 仓库中 HEAD 指向的版本）。
* remote就是远端的代码仓，存放在线的公共的代码。

基础提交代码三大步：

**git add .**

添加所有修改到暂存区

**git commit -m "message"**

提交修改到仓库区域

**git push origin main**

将提交的修改上传到git服务器仓库

## 两种拉取代码的方式
### http克隆
直接通过仓库的https链接就可以拉取下载。

```
git clone https://github.com/stepheneasyshot/stepheneasyshot.github.io.git
```

### ssh克隆
#### 生成本地key
打开cmd命令行，输入以下命令：

```
C:\Users\stephen\Desktop>ssh-keygen -t rsa -b 4096 -C "zhanfeng990927@gmail.com"
Generating public/private rsa key pair.
Enter file in which to save the key (C:\Users\stephen/.ssh/id_rsa):
Created directory 'C:\\Users\\stephen/.ssh'.
Enter passphrase (empty for no passphrase):
Enter same passphrase again:
Your identification has been saved in C:\Users\stephen/.ssh/id_rsa
Your public key has been saved in C:\Users\stephen/.ssh/id_rsa.pub
The key fingerprint is:
SHA256:rkwHDmx9rLxg/4pbuRcIPj7p5YZHD9urJYUGx04Gwdc zhanfeng990927@gmail.com
The key's randomart image is:
+---[RSA 4096]----+
|   XXXXXX        |
|  XXXXXXXXX      |
|  XXXXX          |
|   XXXXXX        |
|  XXXXXXXXXX     |
|  XXXXXXXXXX     |
| XXXXXXXXXXXX    |
| XXXXXXXXXX      |
| XXXXXXXXXXX     |
+----[SHA256]-----+
```

Enter passphrase这两步是提示输入密码，建议不要设置，直接生成。

完毕后在C盘的用户文件夹下应该会生成一个 .ssh 文件夹，可以在 .ssh 目录下看到两个文件：id_rsa 和 id_rsa.pub

其中的pub公钥就是需要上传到git服务器上做验证的文件。

#### 上传key到git服务器
生成SSH Key后，需要将公钥添加到远程Git仓库中。使用cat命令查看公钥内容，Windows上应该直接使用记事本打开即可显示：

```
cat ~/.ssh/id_rsa.pub

一般格式如下：
ssh-rsa XXXXXX...lrw== zhanfeng990927@gmail.com

```

然后，复制这串公钥内容。
登录到远程Git仓库，找到SSH Key配置页面，将公钥粘贴到相应位置并保存。

#### 验证并拉取代码
打开git bash，输入ssh -T git@github.com做初次验证，然后就可以通过ssh的方式拉取github上的代码了：

```
~/Desktop:$ ssh -T git@github.com
The authenticity of host 'github.com (20.205.243.166)' can't be established.
ED25519 key fingerprint is SHA256:+DiY3wvvV6TuJJhbpZisF/zLDA0zPMSvHdkr4UvCOqU.
This key is not known by any other names.
Are you sure you want to continue connecting (yes/no/[fingerprint])? y
Please type 'yes', 'no' or the fingerprint: yes
Warning: Permanently added 'github.com' (ED25519) to the list of known hosts.
Hi stepheneasyshot! You've successfully authenticated, but GitHub does not provide shell access.

~/Desktop:$ git clone git@github.com:stepheneasyshot/stepheneasyshot.github.io.git
Cloning into 'stepheneasyshot.github.io'...

```

## Git文件状态

通常我们需要查看一个文件的状态，使用git status

**Changes not staged for commit**

表示得大概就是工作区有该内容，但是缓存区没有，需要我们git add

**Changes to be committed**

一般而言，这个时候，文件放在缓存区了，我们需要git commit

**nothing to commit, working tree clean**

这个时候，我们将本地的代码推送到远端即可

## git配置
**列出当前配置**

```
git config --list
```

**列出当前Repository配置**

```
git config --local --list
```

**列出全局配置**

```
git config --global --list
```

**列出系统配置**

```
git config --system --list
```

**配置用户名**

```
git config --global user.name "your name"
```

**配置用户邮箱**

```
git config --global user.email "youremail@github.com"
```

## 分支管理
**查看本地分支**

```
git branch
```

**查看远程分支**

```
git branch -r
```

**查看本地和远程分支**

```
git branch -a
```

**从当前分支，切换到其他分支**

```
git checkout <branch-name>
```

**创建并切换到新建分支**

```
git checkout -b <branch-name>
```

**删除分支**

```
git branch -d <branch-name>
// 若有未提交的代码，仍然强行删除刻可以使用 D
```

**当前分支与指定分支合并**

```
git merge <branch-name>
```

**查看哪些分支已经合并到当前分支**

```
git branch --merged
```

**查看哪些分支没有合并到当前分支**

```
git branch --no-merged
```

**查看各个分支最后一个提交对象的信息**

```
git branch -v
```

删除远程分支

```
git push origin -d <branch-name>
```

**重命名分支**

```
git branch -m <oldbranch-name> <newbranch-name>
```

**拉取远程分支并创建本地分支**

```
git checkout -b 本地分支名x origin/远程分支名x

// 另外一种方式,也可以完成这个操作。
git fetch origin <branch-name>:<local-branch-name>
```

**fetch推荐写法**

```
git fetch origin <branch-name>:<local-branch-name>

一般而言，这个origin是远程主机名，一般默认就是origin。
branch-name 你要拉取的分支
local-branch-name 通常而言，就是你本地新建一个新分支，将origin下的某个分支代码下载到本地分支。
```

## 撤销操作
**撤销工作区修改**

```
git checkout -- file
```

**暂存区文件撤销 (不覆盖工作区)**

```
git reset HEAD
```

**版本回退**

```
git reset --(soft | mixed | hard ) < HEAD ~(num) >
可以使用git log 找到commitid，以精确还原
```

## 比较差异
**比较工作区与缓存区**

```
git diff
```

**比较缓存区与本地库最近一次commit内容**

```
git diff -- cached
```

**比较工作区与本地最近一次commit内容**

```
git diff HEAD
```

**比较两个commit之间差异**

```
git diff <commit ID> <commit ID>
```

## 一般分支命名
### master分支
主分支，用于部署生产环境的分支，确保稳定性。
master分支一般由develop以及hotfix分支合并，任何情况下都不能直接修改代码。
### develop 分支
develop为开发分支，通常情况下，保存最新完成以及bug修复后的代码。
开发新功能时，feature分支都是基于develop分支下创建的。
### feature分支
开发新功能，基本上以develop为基础创建feature分支。
分支命名：feature/ 开头的为特性分支， 命名规则: feature/user_module、 feature/cart_module。
### release分支
release 为预上线分支，发布提测阶段，会release分支代码为基准提测。
### hotfix分支
分支命名：hotfix/ 开头的为修复分支，它的命名规则与 feature 分支类似。线上出现紧急问题时，需要及时修复，以master分支为基线，创建hotfix分支，修复完成后，需要合并到master分支和develop分支。

## .gitignore文件配置
这个文件的作用，会去忽略一些不需要纳入Git管理这种，我们也不希望出现在未跟踪文件列表。

一般配置方法：

```
# 井号，此行是注释 会被Git忽略

# 忽略 node_modules/ 目录下所有的文件
node_modules/

# 忽略所有.vscode结尾的文件
.vscode

# 忽略所有.md结尾的文件
*.md

# 但README.md 除外
!README.md

# 会忽略 doc/something.txt 但不会忽略doc/images/arch.txt
doc/*.txt

# 忽略 doc/ 目录下所有扩展名为txt文件

doc/**/*.txt

```

## 提效操作
### git stash
某一天你正在 feature 分支开发新需求，突然产品经理跑过来说线上有bug，必须马上修复。而此时你的功能开发到一半，于是你急忙想切到 master 分支，然后你就会看到以下报错：
```
error: Your local changes to the following files would be overwritten by checkout:

src/entries/index/config/group.js

Please commit your changes or stash them before youswitch branches.

Aborting
```
因为当前有文件更改了，需要提交commit保持工作区干净才能切分支。由于情况紧急，你只有急忙 commit 上去，commit 信息也随便写了个“暂存代码”，于是该分支提交记录就留了一条黑历史...

不想随便写一个commit，又要切代码回去，就可以用```git stash```这个命令。
代码修改会被暂存下来，当从主分支修完bug切回来时，可以使用

```
git stash apply 
```

来恢复代码。

相关命令如下：

```
# 保存当前未commit的代码
git stash

# 保存当前未commit的代码并添加备注
git stash save "备注的内容"

# 列出stash的所有记录
git stash list

# 删除stash的所有记录
git stash clear

# 应用最近一次的stash
git stash apply

# 应用最近一次的stash，随后删除该记录
git stash pop

# 删除最近的一次stash
git stash drop

```
可以生成多条stash，并使用```git stash list```来查看。

```
$ git stash list
stash@{0}: WIP on ...
stash@{1}: WIP on ...
stash@{2}: On ...
```

应用第二条记录：

```
$ git stash apply stash@{1}
```

pop，drop 同理。

