---
layout: post
description: > 
  æœ¬æ–‡ä»‹ç»äº†JVMçš„æ³›å‹å®ç°åŸç†
image: 
  path: /assets/img/blog/blogs_jvm_cover.png
  srcset: 
    1920w: /assets/img/blog/blogs_jvm_cover.png
    960w:  /assets/img/blog/blogs_jvm_cover.png
    480w:  /assets/img/blog/blogs_jvm_cover.png
accent_image: /assets/img/blog/blogs_jvm_cover.png
excerpt_separator: <!--more-->
sitemap: false
---
# JVMæ³›å‹
æ ¹æ®ã€ŠJavaç¼–ç¨‹æ€æƒ³ã€‹ä¸­çš„æè¿°ï¼Œæ³›å‹å‡ºç°çš„åŠ¨æœºï¼š

> ä»£ç è§£è¯»å¤åˆ¶ä»£ç æœ‰å¾ˆå¤šåŸå› ä¿ƒæˆäº†æ³›å‹çš„å‡ºç°ï¼Œè€Œæœ€å¼•äººæ³¨æ„çš„ä¸€ä¸ªåŸå› ï¼Œå°±æ˜¯ä¸ºäº†åˆ›å»ºå®¹å™¨ç±»ã€‚

æ³›å‹çš„æœ¬è´¨å°±æ˜¯"å‚æ•°åŒ–ç±»å‹"ã€‚ä¸€æåˆ°å‚æ•°ï¼Œæœ€ç†Ÿæ‚‰çš„å°±æ˜¯å®šä¹‰æ–¹æ³•çš„æ—¶å€™éœ€è¦å½¢å‚ï¼Œè°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦ä¼ é€’å®å‚ã€‚é‚£"å‚æ•°åŒ–ç±»å‹"å°±æ˜¯å°†åŸæ¥å…·ä½“çš„ç±»å‹å‚æ•°åŒ–ã€‚æ³›å‹çš„å‡ºç°é¿å…äº†å¼ºè½¬çš„æ“ä½œï¼Œåœ¨ç¼–è¯‘å™¨å®Œæˆç±»å‹è½¬åŒ–ï¼Œä¹Ÿå°±é¿å…äº†è¿è¡Œçš„é”™è¯¯ã€‚

ç°åœ¨çš„ç¨‹åºå¼€å‘å¤§éƒ½æ˜¯é¢å‘å¯¹è±¡çš„ï¼Œå¹³æ—¶ä¼šç”¨åˆ°å„ç§ç±»å‹çš„å¯¹è±¡ï¼Œä¸€ç»„å¯¹è±¡é€šå¸¸éœ€è¦ç”¨é›†åˆæ¥å­˜å‚¨å®ƒä»¬ï¼Œå› è€Œå°±æœ‰äº†ä¸€äº›é›†åˆç±»ï¼Œæ¯”å¦‚ Listã€Map ç­‰ã€‚

è¿™äº›é›†åˆç±»é‡Œé¢éƒ½æ˜¯è£…çš„å…·ä½“ç±»å‹çš„å¯¹è±¡ï¼Œå¦‚æœæ¯ä¸ªç±»å‹éƒ½å»å®ç°è¯¸å¦‚ TextViewListã€ActivityList è¿™æ ·çš„å…·ä½“çš„ç±»å‹ï¼Œæ˜¾ç„¶æ˜¯ä¸å¯èƒ½çš„ã€‚

å› æ­¤å°±è¯ç”Ÿäº†ã€Œæ³›å‹ã€ï¼Œå®ƒçš„æ„æ€æ˜¯æŠŠå…·ä½“çš„ç±»å‹æ³›åŒ–ï¼Œç¼–ç çš„æ—¶å€™ç”¨ç¬¦å·æ¥æŒ‡ä»£ç±»å‹ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™ï¼Œå†ç¡®å®šå®ƒçš„ç±»å‹ã€‚

## å®ä¾‹
Javaæ³›å‹ä¹Ÿæ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œåœ¨ç¼–è¯‘é˜¶æ®µå®Œæˆç±»å‹çš„è½¬æ¢çš„å·¥ä½œï¼Œé¿å…åœ¨è¿è¡Œæ—¶å¼ºåˆ¶ç±»å‹è½¬æ¢è€Œå‡ºç° `ClassCastException` ï¼Œç±»å‹è½¬åŒ–å¼‚å¸¸ã€‚

ä¸ä½¿ç”¨æ³›å‹ï¼š

```java
public static void main(String[] args) {
    List list = new ArrayList();
    list.add(11);
    list.add("ssss");
    for (int i = 0; i < list.size(); i++) {
        System.out.println((String)list.get(i));
    }
}
```

å› ä¸ºlistç±»å‹æ˜¯Objectã€‚æ‰€ä»¥int,Stringç±»å‹çš„æ•°æ®éƒ½æ˜¯å¯ä»¥æ”¾å…¥çš„ï¼Œä¹Ÿæ˜¯éƒ½å¯ä»¥å–å‡ºçš„ã€‚ä½†æ˜¯ä¸Šè¿°çš„ä»£ç ï¼Œè¿è¡Œçš„æ—¶å€™å°±ä¼šæŠ›å‡º **ç±»å‹è½¬åŒ–å¼‚å¸¸** ï¼Œè¿™ä¸ªç›¸ä¿¡å¤§å®¶éƒ½èƒ½æ˜ç™½ã€‚

ä½¿ç”¨æ³›å‹ï¼š

```java
public static void main(String[] args) {
        List<String> list = new ArrayList();
        list.add("hahah");
        list.add("ssss");
        for (int i = 0; i < list.size(); i++) {
            System.out.println((String)list.get(i));
        }
    }
```

åœ¨ä¸Šè¿°çš„å®ä¾‹ä¸­ï¼Œæˆ‘ä»¬åªèƒ½æ·»åŠ Stringç±»å‹çš„æ•°æ®ï¼Œå¦åˆ™ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚
## æ³›å‹çš„ä½¿ç”¨
æ³›å‹çš„ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼šæ³›å‹ç±»ï¼Œæ³›å‹æ–¹æ³•ï¼Œæ³›å‹æ¥å£
### æ³›å‹ç±»
å³æŠŠæ³›å‹å®šä¹‰åœ¨ç±»ä¸Šï¼š
```java
public class ç±»å <æ³›å‹ç±»å‹1,...> {
    
}
```

æ³¨æ„äº‹é¡¹ï¼šæ³›å‹ç±»å‹å¿…é¡»æ˜¯å¼•ç”¨ç±»å‹ï¼ˆéåŸºæœ¬æ•°æ®ç±»å‹ï¼‰

### æ³›å‹æ–¹æ³•
æ³›å‹æ–¹æ³•æ¦‚è¿°ï¼šæŠŠæ³›å‹å®šä¹‰åœ¨æ–¹æ³•ä¸Š

```java
public <æ³›å‹ç±»å‹> è¿”å›ç±»å‹ æ–¹æ³•åï¼ˆæ³›å‹ç±»å‹ å˜é‡åï¼‰ {
    
}
```

æ³¨æ„è¦ç‚¹ï¼š

æ–¹æ³•å£°æ˜ä¸­å®šä¹‰çš„å½¢å‚åªèƒ½åœ¨è¯¥æ–¹æ³•é‡Œä½¿ç”¨ï¼Œè€Œæ¥å£ã€ç±»å£°æ˜ä¸­å®šä¹‰çš„ç±»å‹å½¢å‚åˆ™å¯ä»¥åœ¨æ•´ä¸ªæ¥å£ã€ç±»ä¸­ä½¿ç”¨ã€‚å½“è°ƒç”¨ `fun()` æ–¹æ³•æ—¶ï¼Œæ ¹æ®ä¼ å…¥çš„å®é™…å¯¹è±¡ï¼Œç¼–è¯‘å™¨å°±ä¼šåˆ¤æ–­å‡ºç±»å‹å½¢å‚ `T` æ‰€ä»£è¡¨çš„å®é™…ç±»å‹ã€‚

```java
class Demo{  
   public <T> T fun(T t){   // å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„æ•°æ®  
       return t ;     // ç›´æ¥æŠŠå‚æ•°è¿”å›  
  }  
};  
public class GenericsDemo26{  
  public static void main(String args[]){  
    Demo d = new Demo() ; // å®ä¾‹åŒ–Demoå¯¹è±¡  
    String str = d.fun("æ±¤å§†") ; // ä¼ é€’å­—ç¬¦ä¸²  
    int i = d.fun(30) ;  // ä¼ é€’æ•°å­—ï¼Œè‡ªåŠ¨è£…ç®±  
    System.out.println(str) ; // è¾“å‡ºå†…å®¹  
    System.out.println(i) ;  // è¾“å‡ºå†…å®¹  
  }  
};
```

### æ³›å‹æ¥å£
æ³›å‹æ¥å£æ¦‚è¿°ï¼šæŠŠæ³›å‹å®šä¹‰åœ¨æ¥å£

```java
public interface æ¥å£å<æ³›å‹ç±»å‹> {
    
}
```

å®ä¾‹ï¼š

```java
public interface Inter<T> {
    public abstract void show(T t) ;
}
```

```java
/**
 * å­ç±»æ˜¯æ³›å‹ç±»
 */
public class InterImpl<E> implements Inter<E> {
    @Override
    public void show(E t) {
        System.out.println(t);
    }
}

Inter<String> inter = new InterImpl<String>() ;
inter.show("hello") ;
```

## æºç ä¸­æ³›å‹çš„ä½¿ç”¨
ä¸‹é¢æ˜¯Listæ¥å£å’ŒArrayListç±»çš„ä»£ç ç‰‡æ®µã€‚
```java 
//å®šä¹‰æ¥å£æ—¶æŒ‡å®šäº†ä¸€ä¸ªç±»å‹å½¢å‚ï¼Œè¯¥å½¢å‚åä¸ºE
public interface List<E> extends Collection<E> {
   //åœ¨è¯¥æ¥å£é‡Œï¼ŒEå¯ä»¥ä½œä¸ºç±»å‹ä½¿ç”¨
   public E get(int index) {}
   public void add(E e) {} 
}

//å®šä¹‰ç±»æ—¶æŒ‡å®šäº†ä¸€ä¸ªç±»å‹å½¢å‚ï¼Œè¯¥å½¢å‚åä¸ºE
public class ArrayList<E> extends AbstractList<E> implements List<E> {
   //åœ¨è¯¥ç±»é‡Œï¼ŒEå¯ä»¥ä½œä¸ºç±»å‹ä½¿ç”¨
   public void set(E e) {
   .......................
   }
}
```

## æ³›å‹ç±»æ´¾ç”Ÿå­ç±»
çˆ¶ç±»æ´¾ç”Ÿå­ç±»çš„æ—¶å€™ä¸èƒ½åœ¨åŒ…å«ç±»å‹å½¢å‚ï¼Œéœ€è¦ä¼ å…¥å…·ä½“çš„ç±»å‹

é”™è¯¯çš„æ–¹å¼ï¼š

```java
public class A extends Container<K, V> {}
```

æ­£ç¡®çš„æ–¹å¼ï¼š

```java
public class A extends Container<Integer, String> {}
```

ä¹Ÿå¯ä»¥ä¸æŒ‡å®šå…·ä½“çš„ç±»å‹ï¼Œç³»ç»Ÿå°±ä¼šæŠŠK,Vå½¢å‚å½“æˆObjectç±»å‹å¤„ç†

```java
public class A extends Container {}
```

## æ³›å‹æ„é€ å™¨
æ„é€ å™¨ä¹Ÿæ˜¯ä¸€ç§æ–¹æ³•ï¼Œæ‰€ä»¥ä¹Ÿå°±äº§ç”Ÿäº†æ‰€è°“çš„æ³›å‹æ„é€ å™¨ã€‚
å’Œä½¿ç”¨æ™®é€šæ–¹æ³•ä¸€æ ·æ²¡æœ‰åŒºåˆ«ï¼Œä¸€ç§æ˜¯æ˜¾ç¤ºæŒ‡å®šæ³›å‹å‚æ•°ï¼Œå¦ä¸€ç§æ˜¯éšå¼æ¨æ–­

```java
class Person {
    public <T> Person(T t) {
        System.out.println(t);
    }
}
```

ä½¿ç”¨ï¼š

```java
public static void main(String[] args) {
    new Person(22);// éšå¼
    new <String> Person("hello");//æ˜¾ç¤º
}
```

ç‰¹æ®Šè¯´æ˜ï¼š

å¦‚æœæ„é€ å™¨æ˜¯æ³›å‹æ„é€ å™¨ï¼ŒåŒæ—¶è¯¥ç±»ä¹Ÿæ˜¯ä¸€ä¸ªæ³›å‹ç±»çš„æƒ…å†µä¸‹åº”è¯¥å¦‚ä½•ä½¿ç”¨æ³›å‹æ„é€ å™¨ï¼šå› ä¸ºæ³›å‹æ„é€ å™¨å¯ä»¥æ˜¾å¼æŒ‡å®šè‡ªå·±çš„ç±»å‹å‚æ•°ï¼ˆéœ€è¦ç”¨åˆ°è±å½¢ï¼Œæ”¾åœ¨æ„é€ å™¨ä¹‹å‰ï¼‰ï¼Œè€Œæ³›å‹ç±»è‡ªå·±çš„ç±»å‹å®å‚ä¹Ÿéœ€è¦æŒ‡å®šï¼ˆè±å½¢æ”¾åœ¨æ„é€ å™¨ä¹‹åï¼‰ï¼Œè¿™å°±åŒæ—¶å‡ºç°äº†ä¸¤ä¸ªè±å½¢äº†ï¼Œè¿™å°±ä¼šæœ‰ä¸€äº›å°é—®é¢˜ï¼Œå…·ä½“ç”¨æ³•å†è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚

ä»¥ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸ºä»£è¡¨

```java
public class Person<E> {
    public <T> Person(T t) {
        System.out.println(t);
    }
}
```

æ­£ç¡®ç”¨æ³•ï¼š

```java
public static void main(String[] args) {
    Person<String> person = new Person("sss");
}
```

PSï¼šç¼–è¯‘å™¨ä¼šæé†’ä½ æ€ä¹ˆåšçš„


## é«˜çº§é€šé…ç¬¦
### <? extends T> ä¸Šç•Œé€šé…ç¬¦
ä¸Šç•Œé€šé…ç¬¦é¡¾åæ€ä¹‰ï¼Œ `<? extends T>` è¡¨ç¤ºçš„æ˜¯ç±»å‹çš„ä¸Šç•Œã€åŒ…å«è‡ªèº«ã€‘ï¼Œå› æ­¤é€šé…çš„å‚æ•°åŒ–ç±»å‹å¯èƒ½æ˜¯ T æˆ– T çš„å­ç±»ã€‚

æ­£å› ä¸ºæ— æ³•ç¡®å®šå…·ä½“çš„ç±»å‹æ˜¯ä»€ä¹ˆï¼Œaddæ–¹æ³•å—é™ï¼ˆå¯ä»¥æ·»åŠ nullï¼Œå› ä¸ºnullè¡¨ç¤ºä»»ä½•ç±»å‹ï¼‰ï¼Œä½†å¯ä»¥ä»åˆ—è¡¨ä¸­è·å–å…ƒç´ åèµ‹å€¼ç»™çˆ¶ç±»å‹ã€‚å¦‚ä¸Šå›¾ä¸­çš„ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œç¬¬ä¸‰ä¸ªadd()æ“ä½œä¼šå—é™ï¼ŒåŸå› åœ¨äº List å’Œ List æ˜¯ `List<? extends Animal>` çš„å­ç±»å‹ã€‚

å®ƒè¡¨ç¤ºé›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½æ˜¯Animalç±»å‹æˆ–è€…å…¶å­ç±»

```java
List<? extends Animal>
```

è¿™å°±æ˜¯æ‰€è°“çš„ä¸Šé™é€šé…ç¬¦ï¼Œä½¿ç”¨å…³é”®å­—extendsæ¥å®ç°ï¼Œå®ä¾‹åŒ–æ—¶ï¼ŒæŒ‡å®šç±»å‹å®å‚åªèƒ½æ˜¯extendsåç±»å‹çš„å­ç±»æˆ–å…¶æœ¬èº«ã€‚

ä¾‹å¦‚ï¼š
è¿™æ ·å°±ç¡®å®šé›†åˆä¸­å…ƒç´ çš„ç±»å‹ï¼Œè™½ç„¶ä¸ç¡®å®šå…·ä½“çš„ç±»å‹ï¼Œä½†æœ€èµ·ç çŸ¥é“å…¶çˆ¶ç±»ã€‚ç„¶åè¿›è¡Œå…¶ä»–æ“ä½œã€‚

è¿™ç§èµ‹å€¼ç”±äºç±»å‹æ“¦é™¤æœºåˆ¶ï¼Œåœ¨ç¼–è¯‘å™¨å°±ä¼šæç¤ºæŠ¥é”™ã€‚

```java
List<Button> buttons = new ArrayList<Button>();
List<TextView> textViews = buttons;
```

ä½¿ç”¨é€šé…ç¬¦ï¼š

```java
List<Button> buttons = new ArrayList<Button>();
List<? extends TextView> textViews = buttons;
```

ä¸Šç•Œé€šé…ç¬¦å¯ä»¥ä½¿ Java æ³›å‹å…·æœ‰ã€Œåå˜æ€§ Covarianceã€ï¼Œåå˜å°±æ˜¯å…è®¸ä¸Šé¢çš„èµ‹å€¼æ˜¯åˆæ³•çš„ã€‚

å‰é¢è¯´åˆ° `List<? extends TextView>` çš„æ³›å‹ç±»å‹æ˜¯ä¸ªæœªçŸ¥ç±»å‹ ?ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ç¡®å®šå®ƒæ˜¯å•¥ç±»å‹ï¼Œåªæ˜¯æœ‰ä¸ªé™åˆ¶æ¡ä»¶ã€‚

ç”±äºå®ƒæ»¡è¶³ `? extends TextView` çš„é™åˆ¶æ¡ä»¶ï¼Œæ‰€ä»¥ get å‡ºæ¥çš„å¯¹è±¡ï¼Œè‚¯å®šæ˜¯ `TextView` çš„å­ç±»å‹ï¼Œæ ¹æ®å¤šæ€çš„ç‰¹æ€§ï¼Œèƒ½å¤Ÿèµ‹å€¼ç»™ TextViewï¼Œå•°å—¦ä¸€å¥ï¼Œèµ‹å€¼ç»™ `View` ä¹Ÿæ˜¯æ²¡é—®é¢˜çš„ã€‚

åˆ°äº† add æ“ä½œçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™ä¹ˆç†è§£ï¼š

* `List<? extends TextView>`  ç”±äºç±»å‹æœªçŸ¥ï¼Œå®ƒå¯èƒ½æ˜¯ `List<Button>`ï¼Œä¹Ÿå¯èƒ½æ˜¯ `List<TextView>`ã€‚
* å¯¹äºå‰è€…ï¼Œæ˜¾ç„¶æˆ‘ä»¬è¦æ·»åŠ  TextView æ˜¯ä¸å¯ä»¥çš„ã€‚

å®é™…æƒ…å†µæ˜¯ç¼–è¯‘å™¨æ— æ³•ç¡®å®šåˆ°åº•å±äºå“ªä¸€ç§ï¼Œæ— æ³•ç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œå°±æŠ¥é”™äº†ã€‚

ç”±äº add çš„è¿™ä¸ªé™åˆ¶ï¼Œä½¿ç”¨äº† ? extends æ³›å‹é€šé…ç¬¦çš„ Listï¼Œåªèƒ½å¤Ÿå‘å¤–æä¾›æ•°æ®è¢«æ¶ˆè´¹ï¼Œä»è¿™ä¸ªè§’åº¦æ¥è®²ï¼Œå‘å¤–æä¾›æ•°æ®çš„ä¸€æ–¹ç§°ä¸ºã€Œç”Ÿäº§è€… Producerã€ã€‚å¯¹åº”çš„è¿˜æœ‰ä¸€ä¸ªæ¦‚å¿µå«ã€Œæ¶ˆè´¹è€… Consumerã€ï¼Œå¯¹åº” Java é‡Œé¢å¦ä¸€ä¸ªæ³›å‹é€šé…ç¬¦ ? superã€‚
### <? super T> ä¸‹ç•Œé€šé…ç¬¦
ä¸‹ç•Œé€šé…ç¬¦ `<? super T>` è¡¨ç¤ºçš„æ˜¯å‚æ•°åŒ–ç±»å‹æ˜¯ T çš„è¶…ç±»å‹ï¼ˆåŒ…å«è‡ªèº«ï¼‰ï¼Œå±‚å±‚è‡³ä¸Šï¼Œç›´è‡³Objectã€‚ä¸‹ç•Œé€šé…ç¬¦å¯ä»¥ä½¿ Java æ³›å‹å…·æœ‰ã€Œé€†å˜æ€§ Contravarianceã€ã€‚

ä¸ä¸Šç•Œé€šé…ç¬¦å¯¹åº”ï¼Œè¿™é‡Œ super é™åˆ¶äº†é€šé…ç¬¦ ? çš„å­ç±»å‹ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºä¸‹ç•Œã€‚

å®ƒä¹Ÿæœ‰ä¸¤å±‚æ„æ€ï¼š

* é€šé…ç¬¦ ? è¡¨ç¤º List çš„æ³›å‹ç±»å‹æ˜¯ä¸€ä¸ªæœªçŸ¥ç±»å‹ã€‚
* super é™åˆ¶äº†è¿™ä¸ªæœªçŸ¥ç±»å‹çš„ä¸‹ç•Œï¼Œä¹Ÿå°±æ˜¯æ³›å‹ç±»å‹å¿…é¡»æ»¡è¶³è¿™ä¸ª super çš„é™åˆ¶æ¡ä»¶ã€‚
  * super æˆ‘ä»¬åœ¨ç±»çš„æ–¹æ³•é‡Œé¢ç»å¸¸ç”¨åˆ°ï¼Œè¿™é‡Œçš„èŒƒå›´ä¸ä»…åŒ…æ‹¬ Button çš„ç›´æ¥å’Œé—´æ¥çˆ¶ç±»ï¼Œä¹ŸåŒ…æ‹¬ä¸‹ç•Œ Button æœ¬èº«ã€‚
  * super åŒæ ·æ”¯æŒ interfaceã€‚

```java
List<? super Button> buttons = new ArrayList<Button>();
List<? super Button> buttons = new ArrayList<TextView>();
List<? super Button> buttons = new ArrayList<Object>();
```

ä½¿ç”¨ä¸‹ç•Œé€šé…ç¬¦ ? super çš„æ³›å‹ Listï¼Œåªèƒ½è¯»å–åˆ° Object å¯¹è±¡ï¼Œä¸€èˆ¬æ²¡æœ‰ä»€ä¹ˆå®é™…çš„ä½¿ç”¨åœºæ™¯ï¼Œé€šå¸¸ä¹Ÿåªæ‹¿å®ƒæ¥æ·»åŠ æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ¶ˆè´¹å·²æœ‰çš„ List<? super Button>ï¼Œå¾€é‡Œé¢æ·»åŠ  Buttonï¼Œå› æ­¤è¿™ç§æ³›å‹ç±»å‹å£°æ˜ç§°ä¹‹ä¸ºã€Œæ¶ˆè´¹è€… Consumerã€ã€‚

### <?> æ— ç•Œé€šé…ç¬¦
ä»»æ„ç±»å‹ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®ï¼Œé‚£ä¹ˆå°±æ˜¯Objectä»¥åŠä»»æ„çš„Javaç±»äº†
æ— ç•Œé€šé…ç¬¦ç”¨ `<?>` è¡¨ç¤ºï¼Œ?ä»£è¡¨äº†ä»»ä½•çš„ä¸€ç§ç±»å‹ï¼Œèƒ½ä»£è¡¨ä»»ä½•ä¸€ç§ç±»å‹çš„åªæœ‰nullï¼ˆObjectæœ¬èº«ä¹Ÿç®—æ˜¯ä¸€ç§ç±»å‹ï¼Œä½†å´ä¸èƒ½ä»£è¡¨ä»»ä½•ä¸€ç§ç±»å‹ï¼Œæ‰€ä»¥Listå’ŒListçš„å«ä¹‰æ˜¯ä¸åŒçš„ï¼Œå‰è€…ç±»å‹æ˜¯Objectï¼Œä¹Ÿå°±æ˜¯ç»§æ‰¿æ ‘çš„æœ€ä¸Šå±‚ï¼Œè€Œåè€…çš„ç±»å‹å®Œå…¨æ˜¯æœªçŸ¥çš„ï¼‰

## æ³›å‹æ“¦é™¤
Java æ³›å‹æ“¦é™¤ï¼ˆType Erasureï¼‰æ˜¯ Java è¯­è¨€å®ç°æ³›å‹çš„ä¸€ç§æœºåˆ¶ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒæ„å‘³ç€åœ¨ç¼–è¯‘æ—¶æœŸï¼Œæ‰€æœ‰æ³›å‹ç±»å‹ä¿¡æ¯éƒ½ä¼šè¢«â€œæ“¦é™¤â€æ‰ï¼Œæ›¿æ¢æˆå®ƒä»¬çš„**ä¸Šç•Œç±»å‹ï¼ˆå¦‚æœå­˜åœ¨ï¼‰**æˆ– Object ç±»å‹ï¼ˆå¦‚æœä¸å­˜åœ¨ä¸Šç•Œï¼‰ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒJVM å®é™…ä¸Šå¹¶ä¸çŸ¥é“æ³›å‹çš„å…·ä½“ç±»å‹å‚æ•°ã€‚

ç¼–è¯‘å™¨ç¼–è¯‘å¸¦ç±»å‹è¯´æ˜çš„é›†åˆæ—¶ä¼šå»æ‰ç±»å‹ä¿¡æ¯

3.2 éªŒè¯å®ä¾‹ï¼š

```java
public class GenericTest {
    public static void main(String[] args) {
        new GenericTest().testType();
    }

    public void testType(){
        ArrayList<Integer> collection1 = new ArrayList<Integer>();
        ArrayList<String> collection2= new ArrayList<String>();
        
        System.out.println(collection1.getClass()==collection2.getClass());
        //ä¸¤è€…classç±»å‹ä¸€æ ·,å³å­—èŠ‚ç ä¸€è‡´
        
        System.out.println(collection2.getClass().getName());
        //classå‡ä¸ºjava.util.ArrayList,å¹¶æ— å®é™…ç±»å‹å‚æ•°ä¿¡æ¯
    }
}
```

è¾“å‡ºç»“æœï¼š

```
true
java.util.ArrayList
```

åˆ†æï¼š

> è¿™æ˜¯å› ä¸ºä¸ç®¡ä¸ºæ³›å‹çš„ç±»å‹å½¢å‚ä¼ å…¥å“ªä¸€ç§ç±»å‹å®å‚ï¼Œå¯¹äºJavaæ¥è¯´ï¼Œå®ƒä»¬ä¾ç„¶è¢«å½“æˆåŒä¸€ç±»å¤„ç†ï¼Œåœ¨å†…å­˜ä¸­ä¹Ÿåªå ç”¨ä¸€å—å†…å­˜ç©ºé—´ã€‚ä»Javaæ³›å‹è¿™ä¸€æ¦‚å¿µæå‡ºçš„ç›®çš„æ¥çœ‹ï¼Œå…¶åªæ˜¯ä½œç”¨äºä»£ç ç¼–è¯‘é˜¶æ®µï¼Œåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå¯¹äºæ­£ç¡®æ£€éªŒæ³›å‹ç»“æœåï¼Œä¼šå°†æ³›å‹çš„ç›¸å…³ä¿¡æ¯æ“¦å‡ºï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæˆåŠŸç¼–è¯‘è¿‡åçš„classæ–‡ä»¶ä¸­æ˜¯ä¸åŒ…å«ä»»ä½•æ³›å‹ä¿¡æ¯çš„ã€‚æ³›å‹ä¿¡æ¯ä¸ä¼šè¿›å…¥åˆ°è¿è¡Œæ—¶é˜¶æ®µã€‚

åœ¨é™æ€æ–¹æ³•ã€é™æ€åˆå§‹åŒ–å—æˆ–è€…é™æ€å˜é‡çš„å£°æ˜å’Œåˆå§‹åŒ–ä¸­ä¸å…è®¸ä½¿ç”¨ç±»å‹å½¢å‚ã€‚ç”±äºç³»ç»Ÿä¸­å¹¶ä¸ä¼šçœŸæ­£ç”Ÿæˆæ³›å‹ç±»ï¼Œæ‰€ä»¥instanceofè¿ç®—ç¬¦åä¸èƒ½ä½¿ç”¨æ³›å‹ç±»

## æ³›å‹ä¸åå°„
æŠŠæ³›å‹å˜é‡å½“æˆæ–¹æ³•çš„å‚æ•°ï¼Œåˆ©ç”¨Methodç±»çš„ `getGenericParameterTypes` æ–¹æ³•æ¥è·å–æ³›å‹çš„å®é™…ç±»å‹å‚æ•°

ä¾‹å­ï¼š

```java
public class GenericTest {

    public static void main(String[] args) throws Exception {
        getParamType();
    }
    
     /*åˆ©ç”¨åå°„è·å–æ–¹æ³•å‚æ•°çš„å®é™…å‚æ•°ç±»å‹*/
    public static void getParamType() throws NoSuchMethodException{
        Method method = GenericTest.class.getMethod("applyMap",Map.class);
        //è·å–æ–¹æ³•çš„æ³›å‹å‚æ•°çš„ç±»å‹
        Type[] types = method.getGenericParameterTypes();
        System.out.println(types[0]);
        //å‚æ•°åŒ–çš„ç±»å‹
        ParameterizedType pType  = (ParameterizedType)types[0];
        //åŸå§‹ç±»å‹
        System.out.println(pType.getRawType());
        //å®é™…ç±»å‹å‚æ•°
        System.out.println(pType.getActualTypeArguments()[0]);
        System.out.println(pType.getActualTypeArguments()[1]);
    }

    /*ä¾›æµ‹è¯•å‚æ•°ç±»å‹çš„æ–¹æ³•*/
    public static void applyMap(Map<Integer,String> map){

    }
}
```

è¾“å‡ºç»“æœï¼š

```
java.util.Map<java.lang.Integer, java.lang.String>
interface java.util.Map
class java.lang.Integer
class java.lang.String
```

é€šè¿‡åå°„ç»•å¼€ç¼–è¯‘å™¨å¯¹æ³›å‹çš„ç±»å‹é™åˆ¶

```java
public static void main(String[] args) throws Exception {
		//å®šä¹‰ä¸€ä¸ªåŒ…å«intçš„é“¾è¡¨
		ArrayList<Integer> al = new ArrayList<Integer>();
		al.add(1);
		al.add(2);
		//è·å–é“¾è¡¨çš„addæ–¹æ³•ï¼Œæ³¨æ„è¿™é‡Œæ˜¯Object.classï¼Œå¦‚æœå†™int.classä¼šæŠ›å‡ºNoSuchMethodExceptionå¼‚å¸¸
		Method m = al.getClass().getMethod("add", Object.class);
		//è°ƒç”¨åå°„ä¸­çš„addæ–¹æ³•åŠ å…¥ä¸€ä¸ªstringç±»å‹çš„å…ƒç´ ï¼Œå› ä¸ºaddæ–¹æ³•çš„å®é™…å‚æ•°æ˜¯Object
		m.invoke(al, "hello");
		System.out.println(al.get(2));
	}
```

## æ³›å‹çš„é™åˆ¶
### æ¨¡ç³Šæ€§é”™è¯¯
å¯¹äºæ³›å‹ç±» `User<K,V>` è€Œè¨€ï¼Œå£°æ˜äº†ä¸¤ä¸ªæ³›å‹ç±»å‚æ•°ã€‚åœ¨ç±»ä¸­æ ¹æ®ä¸åŒçš„ç±»å‹å‚æ•°é‡è½½showæ–¹æ³•ã€‚

```java
public class User<K, V> {
    
    public void show(K k) { // æŠ¥é”™ä¿¡æ¯ï¼š'show(K)' clashes with 'show(V)'; both methods have same erasure
        
    }
    public void show(V t) {

    }
}
```

ç”±äºæ³›å‹æ“¦é™¤ï¼ŒäºŒè€…æœ¬è´¨ä¸Šéƒ½æ˜¯Obejctç±»å‹ã€‚æ–¹æ³•æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

æ¢ä¸€ä¸ªæ–¹å¼ï¼š

```java
public class User<K, V> {

    public void show(String k) {

    }
    public void show(V t) {

    }
}
```

å¯ä»¥æ­£å¸¸çš„ä½¿ç”¨

### ä¸èƒ½å®ä¾‹åŒ–ç±»å‹å‚æ•°
ç¼–è¯‘å™¨ä¹Ÿä¸çŸ¥é“è¯¥åˆ›å»ºé‚£ç§ç±»å‹çš„å¯¹è±¡

```java
public class User<K, V> {

    private K key = new K(); // æŠ¥é”™ï¼šType parameter 'K' cannot be instantiated directly

}
```

### å¯¹é™æ€æˆå‘˜çš„é™åˆ¶
é™æ€æ–¹æ³•æ— æ³•è®¿é—®ç±»ä¸Šå®šä¹‰çš„æ³›å‹ï¼›å¦‚æœé™æ€æ–¹æ³•æ“ä½œçš„ç±»å‹ä¸ç¡®å®šï¼Œå¿…é¡»è¦å°†æ³›å‹å®šä¹‰åœ¨æ–¹æ³•ä¸Šã€‚

å¦‚æœé™æ€æ–¹æ³•è¦ä½¿ç”¨æ³›å‹çš„è¯ï¼Œå¿…é¡»å°†é™æ€æ–¹æ³•å®šä¹‰æˆæ³›å‹æ–¹æ³•ã€‚

```java
public class User<T> {

    //é”™è¯¯
    private static T t;

    //é”™è¯¯
    public static T getT() {
        return t;
    }

    //æ­£ç¡®
    public static <K> void test(K k) {

    }
}
```

### å¯¹æ³›å‹æ•°ç»„çš„é™åˆ¶
ä¸èƒ½å®ä¾‹åŒ–å…ƒç´ ç±»å‹ä¸ºç±»å‹å‚æ•°çš„æ•°ç»„ï¼Œä½†æ˜¯å¯ä»¥å°†æ•°ç»„æŒ‡å‘ç±»å‹å…¼å®¹çš„æ•°ç»„çš„å¼•ç”¨

```java
public class User<T> {

    private T[] values;

    public User(T[] values) {
        //é”™è¯¯ï¼Œä¸èƒ½å®ä¾‹åŒ–å…ƒç´ ç±»å‹ä¸ºç±»å‹å‚æ•°çš„æ•°ç»„
        this.values = new T[5];
        //æ­£ç¡®ï¼Œå¯ä»¥å°†values æŒ‡å‘ç±»å‹å…¼å®¹çš„æ•°ç»„çš„å¼•ç”¨
        this.values = values;
    }
}
```

### å¯¹æ³›å‹å¼‚å¸¸çš„é™åˆ¶
æ³›å‹ç±»å‹ä¸èƒ½ç”¨äº catch è¯­å¥ï¼Œä¾‹å¦‚

```java
 try { ... } catch (MyGenericException<T> e) { ... } 
```

æ˜¯ä¸å…è®¸çš„ã€‚

## Kotlinä¸­çš„æ³›å‹
æœ¬èŠ‚æ‘˜è‡ªæ‰”ç‰©çº¿çš„æ–‡ç« ï¼š

[Kotlin çš„æ³›å‹](https://rengwuxian.com/kotlin-generics/)

### Kotlin ä¸­çš„ out å’Œ in
å’Œ Java æ³›å‹ä¸€æ ·ï¼ŒKolin ä¸­çš„æ³›å‹æœ¬èº«ä¹Ÿæ˜¯ä¸å¯å˜çš„ã€‚

ä½¿ç”¨å…³é”®å­— out æ¥æ”¯æŒåå˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸Šç•Œé€šé…ç¬¦ ? extendsã€‚
ä½¿ç”¨å…³é”®å­— in æ¥æ”¯æŒé€†å˜ï¼Œç­‰åŒäº Java ä¸­çš„ä¸‹ç•Œé€šé…ç¬¦ ? superã€‚

```kotlin
var textViews: List<out TextView>
var textViews: List<in TextView>
```

æ¢äº†ä¸ªå†™æ³•ï¼Œä½†ä½œç”¨æ˜¯å®Œå…¨ä¸€æ ·çš„ã€‚out è¡¨ç¤ºï¼Œæˆ‘è¿™ä¸ªå˜é‡æˆ–è€…å‚æ•°åªç”¨æ¥è¾“å‡ºï¼Œä¸ç”¨æ¥è¾“å…¥ï¼Œä½ åªèƒ½è¯»æˆ‘ä¸èƒ½å†™æˆ‘ï¼›in å°±åè¿‡æ¥ï¼Œè¡¨ç¤ºå®ƒåªç”¨æ¥è¾“å…¥ï¼Œä¸ç”¨æ¥è¾“å‡ºï¼Œä½ åªèƒ½å†™æˆ‘ä¸èƒ½è¯»æˆ‘ã€‚

### * å·
å‰é¢è®²åˆ°äº† Java ä¸­å•ä¸ª ? å·ä¹Ÿèƒ½ä½œä¸ºæ³›å‹é€šé…ç¬¦ä½¿ç”¨ï¼Œç›¸å½“äº ? extends Objectã€‚
å®ƒåœ¨ Kotlin ä¸­æœ‰ç­‰æ•ˆçš„å†™æ³•ï¼š* å·ï¼Œç›¸å½“äº out Anyã€‚

```kotlin
var list: List<*>
```

å’Œ Java ä¸åŒçš„åœ°æ–¹æ˜¯ï¼Œå¦‚æœä½ çš„ç±»å‹å®šä¹‰é‡Œå·²ç»æœ‰äº† out æˆ–è€… inï¼Œé‚£è¿™ä¸ªé™åˆ¶åœ¨å˜é‡å£°æ˜æ—¶ä¹Ÿä¾ç„¶åœ¨ï¼Œä¸ä¼šè¢« * å·å»æ‰ã€‚

æ¯”å¦‚ä½ çš„ç±»å‹å®šä¹‰é‡Œæ˜¯ out T : Number çš„ï¼Œé‚£å®ƒåŠ ä¸Š <*> ä¹‹åçš„æ•ˆæœå°±ä¸æ˜¯ out Anyï¼Œè€Œæ˜¯ out Numberã€‚

### where å…³é”®å­—
Java ä¸­å£°æ˜ç±»æˆ–æ¥å£çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨ extends æ¥è®¾ç½®è¾¹ç•Œï¼Œå°†æ³›å‹ç±»å‹å‚æ•°é™åˆ¶ä¸ºæŸä¸ªç±»å‹çš„å­é›†ï¼š

```java
//  T çš„ç±»å‹å¿…é¡»æ˜¯ Animal çš„å­ç±»å‹
class Monster<T extends Animal>{
}
```

æ³¨æ„è¿™ä¸ªå’Œå‰é¢è®²çš„å£°æ˜å˜é‡æ—¶çš„æ³›å‹ç±»å‹å£°æ˜æ˜¯ä¸åŒçš„ä¸œè¥¿ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰ ?ã€‚

åŒæ—¶è¿™ä¸ªè¾¹ç•Œæ˜¯å¯ä»¥è®¾ç½®å¤šä¸ªï¼Œç”¨ & ç¬¦å·è¿æ¥ï¼š

```java
// T çš„ç±»å‹å¿…é¡»åŒæ—¶æ˜¯ Animal å’Œ Food çš„å­ç±»å‹
class Monster<T extends Animal & Food>{ 
}
```

Kotlin åªæ˜¯æŠŠ extends æ¢æˆäº† : å†’å·ã€‚

```kotlin
class Monster<T : Animal>
```

è®¾ç½®å¤šä¸ªè¾¹ç•Œå¯ä»¥ä½¿ç”¨ where å…³é”®å­—ï¼š

```kotlin
class Monster<T> where T : Animal, T : Food
```


### reified å…³é”®å­—
ç”±äº Java ä¸­çš„æ³›å‹å­˜åœ¨ç±»å‹æ“¦é™¤çš„æƒ…å†µï¼Œä»»ä½•åœ¨è¿è¡Œæ—¶éœ€è¦çŸ¥é“æ³›å‹ç¡®åˆ‡ç±»å‹ä¿¡æ¯çš„æ“ä½œéƒ½æ²¡æ³•ç”¨äº†ã€‚

æ¯”å¦‚ä½ ä¸èƒ½æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦ä¸ºæ³›å‹ç±»å‹ T çš„å®ä¾‹ï¼š

```java
<T> void printIfTypeMatch(Object item) {
    if (item instanceof T) { // ğŸ‘ˆ IDE ä¼šæç¤ºé”™è¯¯ï¼Œillegal generic type for instanceof
        System.out.println(item);
    }
}
```

Kotlin é‡ŒåŒæ ·ä¹Ÿä¸è¡Œï¼š

```kotlin
fun <T> printIfTypeMatch(item: Any) {
    if (item is T) { // ğŸ‘ˆ IDE ä¼šæç¤ºé”™è¯¯ï¼ŒCannot check for instance of erased type: T
        println(item)
    }
}
```

è¿™ä¸ªé—®é¢˜ï¼Œåœ¨ Java ä¸­çš„è§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯é¢å¤–ä¼ é€’ä¸€ä¸ª `Class<T> ` ç±»å‹çš„å‚æ•°ï¼Œç„¶åé€šè¿‡ `Class#isInstance` æ–¹æ³•æ¥æ£€æŸ¥ï¼š

```java
<T> void check(Object item, Class<T> type) {
    if (type.isInstance(item)) {
        System.out.println(item);
    }
}
```

Kotlin ä¸­åŒæ ·å¯ä»¥è¿™ä¹ˆè§£å†³ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ä¸ªæ›´æ–¹ä¾¿çš„åšæ³•ï¼šä½¿ç”¨å…³é”®å­— reified é…åˆ inline æ¥è§£å†³ï¼š

```kotlin
inline fun <reified T> printIfTypeMatch(item: Any) {
    if (item is T) {
        println(item)
    }
}
```
