---
layout: post
description: > 
  本文介绍了Jetpack Compose中一系列动画API的使用
image: 
  path: /assets/img/blog/blogs_compose_cover.png
  srcset: 
    1920w: /assets/img/blog/blogs_compose_cover.png
    960w:  /assets/img/blog/blogs_compose_cover.png
    480w:  /assets/img/blog/blogs_compose_cover.png
accent_image: /assets/img/blog/blogs_compose_cover.png
excerpt_separator: <!--more-->
sitemap: false
---
# Compose中的动画
### 出现消失动画
**AnimatedVisibility** 是Jetpack Compose中一个非常有用的动画API，它可以让我们在Composable函数中实现元素的出现和消失动画。它的使用非常简单，只需要在需要添加动画效果的元素上使用AnimatedVisibility即可。

AnimatedVisibility 的方法签名如下：

```kotlin
@Composable
fun ColumnScope.AnimatedVisibility(
    visible: Boolean,
    modifier: Modifier = Modifier,
    enter: EnterTransition = fadeIn() + expandVertically(),
    exit: ExitTransition = fadeOut() + shrinkVertically(),
    label: String = "AnimatedVisibility",
    content: @Composable AnimatedVisibilityScope.() -> Unit
) {
    val transition = updateTransition(visible, label)
    AnimatedVisibilityImpl(transition, { it }, modifier, enter, exit, content = content)
}
```

> visible是一个布尔值，用于控制元素的出现和消失。
modifier是一个Modifier对象，用于修改元素的外观。
enter是一个EnterTransition对象，用于控制元素出现时的动画效果。
exit是一个ExitTransition对象，用于控制元素消失时的动画效果。
label是一个字符串，用于标识元素。
content是一个Composable函数，用于定义元素的内容。

可以看到 Compose 为了简化使用，已经预设了进出场的动画，进场是fadeIn() + expandVertically()，出场是fadeOut() + shrinkVertically()。

如果需要自定义动画效果，可以手动声明并传入 AnimatedVisibility 的enter和exit参数。

enter参数是一个EnterTransition对象，用于控制元素出现时的动画效果。

举例，设置两个text，上面那个text点击后开始退场，2s后重新出现。

![](/assets/img/blog/blogs_compose_anim_visibility.png){:width="300" height="200" loading="lazy"}

源码如下：

```kotlin
@Composable
fun AnimatedVisibilityDemo() {
    Column(modifier = Modifier.width(IntrinsicSize.Max)) {

        val scope = rememberCoroutineScope()

        val isShow = remember { mutableStateOf(true) }

        AnimatedVisibility(visible = isShow.value) {
            Text(
                text = "How are you?",
                color = Color.White,
                modifier = Modifier
                    .fillMaxWidth(1f)
                    .background(Color.Red)
                    .clip(RoundedCornerShape(10))
                    .clickable {
                        isShow.value = false // 点击后消失
                        scope.launch {
                            delay(2000)
                            isShow.value = true // 2秒后重新出现
                        }
                    }
                    .padding(20.dp)
            )
        }

        Text(
            text = "I'm fine, thank you! And you?",
            color = Color.White,
            modifier = Modifier
                .fillMaxWidth(1f)
                .background(Color.Blue)
                .clip(RoundedCornerShape(10))
                .padding(20.dp)
        )
    }
}
```