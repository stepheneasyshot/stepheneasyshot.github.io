---
layout: post
description: > 
  本文介绍Kotlin协程的相关内容，主要为使用层面的总结记录
image: 
  path: /assets/img/blog/blogs_kotlin_cover2.png
  srcset: 
    1920w: /assets/img/blog/blogs_kotlin_cover2.png
    960w:  /assets/img/blog/blogs_kotlin_cover2.png
    480w:  /assets/img/blog/blogs_kotlin_cover2.png
accent_image: /assets/img/blog/blogs_kotlin_cover2.png
excerpt_separator: <!--more-->
sitemap: false
---
# Kotlin协程使用总结
## 简介
协程是一种并发设计模式，您可以在 Android 平台上使用它来简化异步执行的代码。协程 是在 1.3 版中添加到 Kotlin 的，基于既定的从其他语言转换成的概念。

在 `Android` 上，协程有助于管理长时间运行的任务，如果管理不当，这些任务可能会阻塞主线程并导致应用无响应。使用协程的专业开发者中有超过 50% 的人反映使用协程提高了工作效率。本主题介绍如何使用 `Kotlin` 协程解决以下问题，从而让您能够编写出更清晰、更简洁的应用代码。

### 协程的四个基础概念
* suspend function。即挂起函数，delay() 就是协程库提供的一个用于实现非阻塞式延时的挂起函数
* CoroutineScope。即协程作用域，GlobalScope 是 CoroutineScope 的一个实现类，用于指定协程的作用范围，可用于管理多个协程的生命周期，所有协程都需要通过 CoroutineScope 来启动
* CoroutineContext。即协程上下文，包含多种类型的配置参数。Dispatchers.IO 就是 CoroutineContext 这个抽象概念的一种实现，用于指定协程的运行载体，即用于指定协程要运行在哪类线程上
* CoroutineBuilder。即协程构建器，协程在 CoroutineScope 的上下文中通过 launch、async 等协程构建器来进行声明并启动。launch、async 均被声明为 CoroutineScope 的扩展方法

## 协程基本使用步骤
在Android平台使用协程，首先需要引入协程库：在项目的build.gradle.kts文件中添加以下依赖：

```kotlin
dependencies {
    implementation("org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.9")
}
```

创建协程：使用`coroutineScope`或`GlobalScope`来创建一个协程。同时android也提供了不同的协程作用域，如`viewModelScope`、`lifecycleScope`等。可以感知生命周期变化，自动取消，自动执行等。

```kotlin
// Create a coroutine scope
val coroutineScope = CoroutineScope(Dispatchers.Main)
// Create a coroutine
coroutineScope.launch {
    // Do some asynchronous work
    val result = withContext(Dispatchers.IO) {
        // Perform some long-running operation
        // ...
    }
    // Update the UI with the result
    // ...
}
```

执行异步操作：使用 `withContext` 可以切换作用域，可以理解成性质不同的线程。

```kotlin
// Execute an asynchronous operation
val result = withContext(Dispatchers.IO) {
    // Perform some long-running operation
    //...
}
```

处理结果：使用async和await来处理协程的结果。

```kotlin
// Handle the result of an asynchronous operation
val result = async {
    // Perform some asynchronous operation
    //...
}
// Wait for the result
val resultValue = result.await()
```

取消协程：使用`cancel`来取消一个协程。

```kotlin
// Cancel a coroutine
coroutineScope.cancel()
```

## 协程的使用场景

协程的使用场景主要有以下几个：

* 网络请求：当需要进行网络请求时，可以使用协程来执行异步操作，避免阻塞主线程。
* 文件读写：当需要进行文件读写时，可以使用协程来执行异步操作，避免阻塞主线程。
* 数据库操作：当需要进行数据库操作时，可以使用协程来执行异步操作，避免阻塞主线程。
* 定时器：当需要进行定时操作时，可以使用协程来执行异步操作，避免阻塞主线程。
* 动画：当需要进行动画时，可以使用协程来执行异步操作，避免阻塞主线程。

## 大纲参考文章
学习通了再写文章记录
[大纲使用api](https://juejin.cn/post/6908271959381901325#heading-36)
[思维模型](https://juejin.cn/post/7436046565583896630)
