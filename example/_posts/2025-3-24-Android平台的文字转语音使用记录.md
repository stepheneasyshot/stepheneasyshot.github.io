---
layout: post
description: > 
  本文介绍了JVM虚拟机，Dalvik虚拟机还有ART虚拟机三者之间不同特点的对比
image: 
  path: /assets/img/blog/blogs_cover_tts.png
  srcset: 
    1920w: /assets/img/blog/blogs_cover_tts.png
    960w:  /assets/img/blog/blogs_cover_tts.png
    480w:  /assets/img/blog/blogs_cover_tts.png
accent_image: /assets/img/blog/blogs_cover_tts.png
excerpt_separator: <!--more-->
sitemap: false
---
# Android平台的文字转语音使用记录
## 背景
最近在做AI大模型对接的一些功能，调用完chat接口返回结果之后，发现豆包和Kimi等英语都有语音播报功能，这些大厂经过一系列调优，可以实现很好听的音色和节奏停顿的效果。

那个人开发者可不可以在系统自带的免费语音助手的基础上做一个tts（Text To Speech）的播报呢？

调查发现Google已经有相关的接口了，并且我使用魅族20Pro手机成功实现了语音播报效果，记录一下使用过程。

## TextSpeech
`TextSpeech` 是Android平台的文字转语音的接口，可以将文本合成为语音，可以支持立即播放，或者存储为音频文件。

就播放功能来说，使用起来非常简单，只需要创建一个TextSpeech对象，然后调用speak方法即可。

方法签名：

```java
    public int speak(final CharSequence text,
                     final int queueMode,
                     final Bundle params,
                     final String utteranceId) {
        return runAction((ITextToSpeechService service) -> {
            Uri utteranceUri = mUtterances.get(text);
            if (utteranceUri != null) {
                return service.playAudio(getCallerIdentity(), utteranceUri, queueMode,
                        getParams(params), utteranceId);
            } else {
                return service.speak(getCallerIdentity(), text, queueMode, getParams(params),
                        utteranceId);
            }
        }, ERROR, "speak");
    }
```

> 参数说明：
> text：要转换的文本
> queueMode：播放模式，有三种：`QUEUE_ADD`、`QUEUE_FLUSH`、`QUEUE_MODE_DEFAULT`
> params：参数，包括语音的语言、音调、语速等
> utteranceId：唯一标识，用于区分不同的语音


