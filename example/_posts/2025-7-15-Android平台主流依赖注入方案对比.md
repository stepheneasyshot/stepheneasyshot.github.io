---
layout: post
description: > 
  æœ¬æ–‡ä»‹ç»äº†Android å¹³å°çš„ä¸»æµä¾èµ–æ³¨å…¥æ–¹æ¡ˆå¯¹æ¯”ï¼Œä¸»è¦æ¶‰åŠDagger,Hilt,Koin
image: 
  path: /assets/img/blog/blogs_di_cover.png
  srcset: 
    1920w: /assets/img/blog/blogs_di_cover.png
    960w:  /assets/img/blog/blogs_di_cover.png
    480w:  /assets/img/blog/blogs_di_cover.png
accent_image: /assets/img/blog/blogs_di_cover.png
excerpt_separator: <!--more-->
sitemap: false
---
# Androidå¹³å°ä¸»æµä¾èµ–æ³¨å…¥æ–¹æ¡ˆå¯¹æ¯”
å½“åˆå­¦è€…ç†Ÿæ‚‰è½¯ä»¶åœ¨è¯¥å¹³å°ä¸Šçš„è¿è¡Œæœºåˆ¶ï¼Œå¼€å§‹å¤§é‡å†™ä»£ç ä¹‹åï¼Œåœ¨è½¯ä»¶é¡¹ç›®çš„æ¶æ„è®¾è®¡ä¸Šåº”è¯¥ç¬¦åˆ `SOLID` åŸåˆ™ã€‚

SOLID æ˜¯ **Robert C. Martinï¼ˆâ€œUncle Bobâ€ï¼‰** æå‡ºçš„ä¸€ç»„äº”ä¸ªåŸºæœ¬åŸåˆ™çš„é¦–å­—æ¯ç¼©å†™ï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…è®¾è®¡æ›´æ˜“äºç†è§£ã€ç»´æŠ¤å’Œæ‰©å±•çš„è½¯ä»¶ç³»ç»Ÿï¼š

```
Single Responsibility Principle (å•ä¸€èŒè´£åŸåˆ™)

Open/Closed Principle (å¼€é—­åŸåˆ™)

Liskov Substitution Principle (é‡Œæ°æ›¿æ¢åŸåˆ™)

Interface Segregation Principle (æ¥å£éš”ç¦»åŸåˆ™)

Dependency Inversion Principle (ä¾èµ–åè½¬åŸåˆ™)
```

å…¶ä¸­çš„ä¾èµ–åè½¬åŸåˆ™æ˜¯æŒ‡ï¼š

> é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡ã€‚æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡ã€‚

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨è®¾è®¡ç³»ç»Ÿæ—¶ï¼Œä¸åº”è¯¥è®©é«˜å±‚ç»„ä»¶ç›´æ¥ä¾èµ–äºä½å±‚ç»„ä»¶çš„å…·ä½“å®ç°ï¼Œè€Œæ˜¯åº”è¯¥è®©å®ƒä»¬éƒ½ä¾èµ–äºæŠ½è±¡ï¼ˆä¾‹å¦‚æ¥å£æˆ–æŠ½è±¡ç±»ï¼‰ã€‚

## ä»€ä¹ˆæ˜¯ä¾èµ–ï¼Ÿ
åœ¨è½¯ä»¶å¼€å‘ä¸­ï¼Œâ€œä¾èµ–â€æŒ‡çš„æ˜¯ä¸€ä¸ªå¯¹è±¡éœ€è¦å¦ä¸€ä¸ªå¯¹è±¡æ¥å®Œæˆå…¶åŠŸèƒ½ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª `Car` å¯¹è±¡å¯èƒ½éœ€è¦ä¸€ä¸ª `Engine` å¯¹è±¡æ‰èƒ½å¯åŠ¨å’Œè¿è¡Œã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è¯´ `Car` **ä¾èµ–** `Engine`ã€‚

ä¼ ç»Ÿçš„åšæ³•æ˜¯ï¼Œ`Car` å¯¹è±¡åœ¨è‡ªå·±çš„å†…éƒ¨åˆ›å»ºæˆ–æŸ¥æ‰¾ `Engine` å¯¹è±¡ï¼š

```java
class Car {
    private Engine engine;

    public Car() {
        this.engine = new Engine(); // Car è‡ªå·±åˆ›å»ºäº† Engine å¯¹è±¡
    }

    public void start() {
        engine.ignite();
        System.out.println("Car started!");
    }
}
```

è¿™ç§ä¹Ÿå«ç›´æ¥ä¾èµ–ï¼Œå…¶é—®é¢˜åœ¨äºï¼š
* ç´§è€¦åˆï¼š å¦‚æœä½å±‚æ¨¡å—çš„å®ç°ç»†èŠ‚å‘ç”Ÿå˜åŒ–ï¼Œé«˜å±‚æ¨¡å—ä¹Ÿå¯èƒ½éœ€è¦ä¿®æ”¹ã€‚
* æµ‹è¯•å›°éš¾ï¼š åœ¨æµ‹è¯•é«˜å±‚æ¨¡å—æ—¶ï¼Œä½ ä¸å¾—ä¸ä¾èµ–çœŸå®çš„ä½å±‚æ¨¡å—ï¼Œè¿™ä½¿å¾—å•å…ƒæµ‹è¯•å˜å¾—å¤æ‚ä¸”æ•ˆç‡ä½ä¸‹ã€‚ä½ æ— æ³•è½»æ˜“åœ°æ›¿æ¢ä¸€ä¸ªæ¨¡æ‹Ÿçš„æ•°æ®è®¿é—®å±‚ã€‚
* å¯æ‰©å±•æ€§å·®ï¼š å¢åŠ æ–°çš„ä½å±‚å®ç°ä¼šå½±å“åˆ°æ‰€æœ‰ä¾èµ–å®ƒçš„é«˜å±‚æ¨¡å—ã€‚

## ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥ï¼Ÿ
ä¾èµ–æ³¨å…¥çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š**ä¸€ä¸ªå¯¹è±¡ä¸åº”è¯¥è‡ªå·±åˆ›å»ºæˆ–æŸ¥æ‰¾å®ƒæ‰€ä¾èµ–çš„å¯¹è±¡ï¼Œè€Œæ˜¯åº”è¯¥ç”±å¤–éƒ¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªâ€œæ³¨å…¥å™¨â€æˆ–â€œå®¹å™¨â€ï¼‰æä¾›è¿™äº›ä¾èµ–ã€‚**  ä¾èµ–åè½¬æ˜¯æˆ‘ä»¬çš„è®¾è®¡ç›®æ ‡ï¼Œä¾èµ–æ³¨å…¥å°±æ˜¯å®ç°çš„è·¯å¾„ã€‚

åœ¨ `Car` å’Œ `Engine` çš„ä¾‹å­ä¸­ï¼Œå¦‚æœä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œ`Car` å°±ä¸å†è´Ÿè´£åˆ›å»º `Engine`ï¼Œè€Œæ˜¯ç­‰å¾…å¤–éƒ¨æŠŠ `Engine` â€œæ³¨å…¥â€è¿›æ¥ã€‚ç»“åˆKotlinçš„æ„é€ å‡½æ•°å†™æ³•ï¼Œ `Car` ç±»å¯ä»¥å†™æˆä¸‹é¢è¿™ç§ç®€æ´çš„å½¢å¼ï¼š

```kotlin
class Car(val engine: Engine) {
    public void start() {
        engine.ignite();
        System.out.println("Car started!");
    }
}
```

è¿™ç§è®¾è®¡æ–¹æ¡ˆæœ‰å“ªäº›å¥½å¤„å‘¢ï¼Ÿ

é¦–å…ˆæœ€æ˜æ˜¾çš„å°±æ˜¯ **è§£è€¦** ï¼Œå¯¹è±¡ä¸å†éœ€è¦å…³å¿ƒå®ƒæ‰€ä¾èµ–å¯¹è±¡çš„åˆ›å»ºç»†èŠ‚ï¼Œå®ƒä»¬åªéœ€è¦çŸ¥é“å¦‚ä½•ä½¿ç”¨è¿™äº›ä¾èµ–ã€‚è¿™ä½¿å¾—ä»£ç æ›´çµæ´»ï¼Œæ›´å®¹æ˜“ä¿®æ”¹å’Œæ‰©å±•ã€‚

å…¶æ¬¡æ˜¯ **å¯æµ‹è¯•æ€§** å’Œ **å¯ç»´æŠ¤æ€§** æé«˜äº†ã€‚æ›´æœ‰åˆ©äºå•å…ƒæµ‹è¯•ï¼ŒåŒæ—¶å½“å¤–éƒ¨çš„ä¾èµ–å‘ç”Ÿå˜åŒ–æ—¶ï¼Œåªéœ€è¦ä¿®æ”¹åˆ›å»ºå’Œæä¾›ä¾èµ–çš„éƒ¨åˆ†ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹æ‰€æœ‰ä¾èµ–è¯¥å¯¹è±¡çš„ä»£ç ã€‚

è¿˜å¯ä»¥ **æé«˜ä»£ç å¤ç”¨æ€§** ï¼Œç‹¬ç«‹çš„å¯¹è±¡å¯ä»¥æ›´å®¹æ˜“åœ°åœ¨ä¸åŒçš„åœºæ™¯å’Œç»„ä»¶ä¸­é‡ç”¨ã€‚

åœ¨ Android ç«¯çš„ä¾èµ–æ³¨å…¥è®¾è®¡ç†å¿µï¼Œæ•´ä½“çš„å‘å±•æ–¹å‘æ˜¯ä»æœ€åˆçš„æ‰‹åŠ¨ç®¡ç†åˆ°åŠŸèƒ½å¼ºå¤§çš„è‡ªåŠ¨åŒ–æ¡†æ¶ã€‚

åœ¨æ—©æœŸçš„ Android å¼€å‘ä¸­ï¼Œå¹¶æ²¡æœ‰æˆç†Ÿçš„ DI æ¡†æ¶ã€‚é€šå¸¸é‡‡ç”¨ç›´æ¥åˆ›å»ºä¾èµ–ç¤ºä¾‹çš„æ–¹å¼ï¼Œåé¢åˆå‡ºç°äº†ç”±ç­–ç•¥æ¨¡å¼é©±åŠ¨çš„æœåŠ¡å®šä½å™¨çš„å½¢å¼æ¥æä¾›ä¾èµ–ã€‚

* **æ‰‹åŠ¨å®ä¾‹åŒ–** è¿™æ˜¯æœ€ç›´æ¥çš„æ–¹å¼ï¼Œåœ¨ä¸€ä¸ªç±»ä¸­ç›´æ¥ `new` å‡ºå®ƒæ‰€éœ€è¦çš„ä¾èµ–ã€‚å¤šäº†ä¹‹åå¯¼è‡´ä»£ç ç´§è€¦åˆï¼Œéš¾ä»¥æµ‹è¯•å’Œç»´æŠ¤ï¼Œç‰¹åˆ«æ˜¯å½“ä¾èµ–é“¾å¾ˆæ·±æ—¶ï¼Œä¿®æ”¹ä¸€ä¸ªåœ°æ–¹å¯èƒ½éœ€è¦æ”¹åŠ¨å¾ˆå¤šåœ°æ–¹ã€‚
* **æœåŠ¡å®šä½å™¨** è¿™ä¸ªæ¨¡å¼ä¼šå¼•å…¥ä¸€ä¸ªä¸­å¤®æ³¨å†Œè¡¨ï¼ˆæˆ–å•ä¾‹ï¼‰æ¥å­˜å‚¨å’Œæä¾›ä¾èµ–ã€‚ç±»éœ€è¦ä¾èµ–æ—¶ï¼Œå°±å‘è¿™ä¸ªæ³¨å†Œè¡¨â€œè¯·æ±‚â€å¯¹åº”çš„å®ä¾‹ã€‚
    * **ä¼˜ç‚¹ï¼š** ç›¸å¯¹äºæ‰‹åŠ¨å®ä¾‹åŒ–ï¼ŒæœåŠ¡å®šä½å™¨æä¾›äº†ä¸€å®šç¨‹åº¦çš„è§£è€¦ï¼Œå› ä¸ºæ¶ˆè´¹è€…ä¸å†ç›´æ¥åˆ›å»ºä¾èµ–ã€‚
    * **é—®é¢˜ï¼š** ä»ç„¶å­˜åœ¨éšè—ä¾èµ–ã€‚ä½ ä¸çŸ¥é“ä¸€ä¸ªç±»éœ€è¦å“ªäº›ä¾èµ–ï¼Œé™¤éæŸ¥çœ‹å…¶å®ç°ã€‚éš¾ä»¥è¿½è¸ªå¯¹è±¡ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶ä¸”æµ‹è¯•æ—¶æ›¿æ¢æ¨¡æ‹Ÿå¯¹è±¡ä¸å¤Ÿä¼˜é›…ã€‚å®ƒæ›´åƒæ˜¯â€œæŸ¥æ‰¾ä¾èµ–â€è€Œä¸æ˜¯â€œæ³¨å…¥ä¾èµ–â€ã€‚

## Dagger 1ï¼šåˆæ¬¡å°è¯•ç¼–è¯‘æ—¶æ³¨å…¥
åœ¨ 2012 å¹´å·¦å³ï¼ŒSquare å…¬å¸æ¨å‡ºäº† **Dagger**ã€‚è¿™æ˜¯ Android å¹³å°ç¬¬ä¸€ä¸ªçœŸæ­£æ„ä¹‰ä¸Šçš„ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œå¹¶ä¸”å®ƒé‡‡ç”¨äº†**ç¼–è¯‘æ—¶**ä»£ç ç”Ÿæˆçš„æ–¹å¼ã€‚

æ²¡æœ‰è¿è¡Œæ—¶çš„åå°„å¼€é”€ï¼Œå¸¦æ¥äº†æ€§èƒ½ä¼˜åŠ¿ã€‚å®ƒä½¿ç”¨äº† **æ³¨è§£å¤„ç†å™¨** åœ¨ç¼–è¯‘é˜¶æ®µç”Ÿæˆæ³¨å…¥ä»£ç ã€‚

ä½†æ˜¯ Dagger çš„é…ç½®å’Œä½¿ç”¨ç›¸å¯¹å¤æ‚ï¼Œå°¤å…¶æ˜¯å¯¹äºå¤§å‹é¡¹ç›®è€Œè¨€ï¼Œç¼–å†™å’Œç»´æŠ¤å¤§é‡çš„æ¨¡å— (Module) å’Œç»„ä»¶ (Component) **æ ·æ¿ä»£ç ** æˆä¸ºä¸€ä¸ªæŒ‘æˆ˜ã€‚
## Dagger 2ï¼šæ€§èƒ½ä¸å¯æ‰©å±•æ€§çš„é£è·ƒ
2015 å¹´ï¼ŒGoogle æ¥æ‰‹ Dagger é¡¹ç›®å¹¶å‘å¸ƒäº†å…¨æ–°çš„ **Dagger 2**ã€‚Dagger 2 æ˜¯å¯¹ Dagger 1 çš„å½»åº•é‡å†™ï¼Œå®ƒç§‰æ‰¿äº† Dagger 1 çš„ **ç¼–è¯‘æ—¶ç”Ÿæˆ** çš„ç‰¹æ€§ï¼Œä½†åœ¨è®¾è®¡ç†å¿µå’Œå®ç°ä¸Šæœ‰äº†é‡å¤§æ”¹è¿›ã€‚

Dagger 2 åœ¨ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç ï¼Œè¿™äº›ä»£ç è´Ÿè´£å®ä¾‹åŒ–å¯¹è±¡å¹¶æä¾›å®ƒä»¬çš„ä¾èµ–ã€‚è¿™æ„å‘³ç€åœ¨è¿è¡Œæ—¶æ²¡æœ‰åå°„å¼€é”€ï¼Œæ€§èƒ½éå¸¸é«˜ã€‚å®ƒé€šè¿‡æ³¨è§£å¤„ç†å™¨æ¥åˆ†æä½ çš„ä»£ç ï¼Œç”Ÿæˆä¸€ä¸ª **ä¾èµ–å›¾** ï¼Œç„¶åæ ¹æ®è¿™ä¸ªå›¾ç”Ÿæˆç›¸åº”çš„ Java ä»£ç ã€‚å®ƒç”Ÿæˆçš„æ˜¯ç›´æ¥çš„ Java ä»£ç ï¼Œæ¨¡æ‹Ÿäº†ä½ åœ¨æ‰‹å†™å·¥å‚ç±»å’Œæä¾›å™¨æ—¶çš„è¡Œä¸ºï¼Œä»è€Œåœ¨æ€§èƒ½ä¸Šè¾¾åˆ°äº†æè‡´ã€‚

è¿è¡Œ Dagger 2 ç¤ºä¾‹éœ€è¦æ·»åŠ  Dagger ä¾èµ–å¹¶é…ç½®æ³¨è§£å¤„ç†å™¨ã€‚åœ¨ Android é¡¹ç›®ä¸­ï¼Œé€šå¸¸åœ¨ `build.gradle` æ–‡ä»¶ä¸­é…ç½®ã€‚æ¯”å¦‚ä½¿ç”¨Kotlinçš„è¯ï¼Œéœ€è¦åœ¨ `build.gradle` ä¸­é…ç½® `kapt` æ’ä»¶ï¼š

```gradle
plugins {
    id 'com.android.application'
    id 'org.jetbrains.kotlin.android'
    id 'kotlin-kapt' // é…ç½® Kotlin æ³¨è§£å¤„ç†å™¨æ’ä»¶
}
```

Dagger 2 åœ¨ä½¿ç”¨æ—¶éœ€è¦å®šä¹‰æ¨¡å—å’Œç»„ä»¶ã€‚

1.  **å®šä¹‰ä¾èµ–æ¥å£å’Œå®ç°ï¼š**
    ```java
    // repository/UserRepository.java
    interface UserRepository {
        void saveUser(String username);
    }

    // repository/DatabaseUserRepository.java
    class DatabaseUserRepository implements UserRepository {
        @Override
        public void saveUser(String username) {
            System.out.println("Saving user " + username + " to database.");
        }
    }
    ```
2.  **å®šä¹‰æä¾›ä¾èµ–çš„ Moduleï¼š**
    ```java
    import dagger.Module;
    import dagger.Provides;
    import javax.inject.Singleton; // Dagger 2 æä¾›çš„ä½œç”¨åŸŸæ³¨è§£

    // di/AppModule.java
    @Module
    public class AppModule {
        @Provides // æä¾› UserRepository å®ä¾‹
        @Singleton // å°† UserRepository å®šä¹‰ä¸ºå•ä¾‹
        UserRepository provideUserRepository() {
            return new DatabaseUserRepository();
        }
    }
    ```
3.  **å®šä¹‰æ³¨å…¥å™¨ Componentï¼š**
    ```java
    import dagger.Component;
    import javax.inject.Singleton;

    // di/AppComponent.java
    @Singleton // AppComponent ä¹Ÿæ˜¯å•ä¾‹ä½œç”¨åŸŸ
    @Component(modules = AppModule.class) // å…³è” AppModule
    public interface AppComponent {
        // å®šä¹‰æ³¨å…¥æ–¹æ³•ï¼ŒMyPresenter å¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•è¢«æ³¨å…¥ä¾èµ–
        void inject(MyPresenterWithDagger presenter);
    }
    ```
4.  **åœ¨éœ€è¦æ³¨å…¥çš„ç±»ä¸­ä½¿ç”¨ `@Inject`ï¼š**
    ```java
    import javax.inject.Inject;

    // presenter/MyPresenterWithDagger.java
    class MyPresenterWithDagger {
        @Inject // å£°æ˜éœ€è¦æ³¨å…¥ UserRepository
        UserRepository userRepository;

        public MyPresenterWithDagger() {
            // Dagger 2 ä¼šåœ¨è°ƒç”¨ inject(this) åè‡ªåŠ¨å¡«å…… userRepository
        }

        public void registerUser(String username) {
            userRepository.saveUser(username);
            System.out.println("User " + username + " registered.");
        }
    }
    ```
5.  **åœ¨ Application æˆ– Main æ–¹æ³•ä¸­åˆå§‹åŒ–å’Œä½¿ç”¨ï¼š**
    ```java
    // main/MainDagger2.java
    public class MainDagger2 {
        public static void main(String[] args) {
            // âœ¨ æ„å»º Dagger ç»„ä»¶ï¼Œè¿™ä¸ª DaggerAppComponent æ˜¯ Dagger 2 ç¼–è¯‘æ—¶ç”Ÿæˆçš„
            AppComponent component = DaggerAppComponent.builder().build();

            MyPresenterWithDagger presenter = new MyPresenterWithDagger();
            // âœ¨ æ‰§è¡Œæ³¨å…¥æ“ä½œï¼ŒDagger ä¼šæ‰¾åˆ° @Inject æ ‡æ³¨çš„å­—æ®µå¹¶å¡«å……ä¾èµ–
            component.inject(presenter);

            presenter.registerUser("Alice");
        }
    }
    ```

Dagger 2 å…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š

* **æé«˜æ€§èƒ½ï¼š** çº¯ç²¹çš„ç¼–è¯‘æ—¶ç”Ÿæˆä»£ç ï¼Œè¿è¡Œæ—¶æ— åå°„å¼€é”€ï¼Œæ€§èƒ½æä½³ã€‚
* **ç±»å‹å®‰å…¨ï¼š** ç¼–è¯‘æ—¶å³å¯å‘ç°ä¾èµ–é”™è¯¯ï¼Œå°†è¿è¡Œæ—¶å´©æºƒé™åˆ°æœ€ä½ã€‚ 
* **å¼ºå¤§çš„æ¨¡å—åŒ–èƒ½åŠ›ï¼š** æä¾›äº† `@Module`ã€`@Provides`ã€`@Component`ã€`@Subcomponent`ã€`@Scope` ç­‰ä¸°å¯Œçš„æ³¨è§£ï¼Œå¯ä»¥ç²¾ç»†åœ°æ§åˆ¶ä¾èµ–çš„æä¾›å’Œç”Ÿå‘½å‘¨æœŸã€‚

Dagger 2 æ¨å‡ºä¹‹åï¼Œå¾ˆå¿«æˆä¸º Android å¹³å°æœ€ä¸»æµã€æœ€å¼ºå¤§çš„ DI æ¡†æ¶ã€‚

å®ƒè§£å†³äº†å¤§è§„æ¨¡é¡¹ç›®ä¸­çš„ä¾èµ–ç®¡ç†éš¾é¢˜ï¼Œä½†ä¹Ÿç»§æ‰¿äº†å…¶å¤æ‚æ€§ï¼Œä»ç„¶éœ€è¦å¼€å‘è€…æŠ•å…¥å¤§é‡æ—¶é—´å­¦ä¹ å’Œé…ç½®ã€‚
## Hiltï¼šGoogle å®˜æ–¹ç®€åŒ– Dagger
2020 å¹´ï¼ŒGoogle æ¨å‡ºäº† **Hilt**ï¼Œè¿™æ˜¯æ„å»ºåœ¨ **Dagger 2 ä¹‹ä¸Š**çš„ Android å®˜æ–¹æ¨èçš„ä¾èµ–æ³¨å…¥åº“ã€‚Hilt çš„ä¸»è¦ç›®æ ‡æ˜¯**ç®€åŒ– Dagger åœ¨ Android åº”ç”¨ä¸­çš„ä½¿ç”¨**ã€‚å¤§é‡å‡å°‘é¡¹ç›®ä¸­ä¸ºäº†å®ç°ä¾èµ–æ³¨å…¥è€Œåˆ›å»ºçš„é‡å¤çš„æ ·æ¿ä»£ç ã€‚

å€¼å¾—ä¸€æçš„æ˜¯ï¼Œåœ¨Googleå®˜æ–¹å¼€æºçš„æ—¨åœ¨å±•ç¤ºæœ€æ–°AndroidæŠ€æœ¯çš„å¼€æºé¡¹ç›®â€”â€” `NowInAndroid` ä¸­ï¼Œå°±ä½¿ç”¨äº†Hiltæ¥å®ç°ä¾èµ–æ³¨å…¥ã€‚

Hilt çš„æ ¸å¿ƒæ€æƒ³æ˜¯é€šè¿‡æä¾›ä¸€å¥— **æ ‡å‡†åŒ–çš„ Android ç»„ä»¶ç»‘å®š** ï¼ˆä¾‹å¦‚ `@AndroidEntryPoint`ã€`@ApplicationContext`ã€`@ActivityContext` ç­‰ï¼‰ï¼Œä»¥åŠé¢„å®šä¹‰çš„ä½œç”¨åŸŸï¼Œæå¤§åœ° **å‡å°‘äº† Dagger æ‰€éœ€çš„æ ·æ¿ä»£ç ** å’Œæ‰‹åŠ¨é…ç½®ã€‚

Hilt åŸºäºæ³¨è§£å®ç°ï¼Œé’ˆå¯¹æ¯ä¸ªéœ€è¦è¢«æ³¨å…¥çš„å±æ€§ï¼ŒHilt éƒ½ä¼šåŸºäº KAPT/KSP åœ¨ç¼–è¯‘æœŸé—´æŸ¥æ‰¾å®ƒçš„æ³¨å…¥æºå¤´ï¼Œå¹¶ç”Ÿæˆä¸€å¯¹ä¸€çš„æ³¨å…¥æ–¹æ³•ã€‚

1.  **æ·»åŠ ä¾èµ–å’Œæ’ä»¶ï¼š** 

    ```gradle
    // project/build.gradle
    buildscript {
        dependencies {
            classpath 'com.google.dagger:hilt-android-gradle-plugin:2.51.1' // æ£€æŸ¥æœ€æ–°ç‰ˆæœ¬
        }
    }

    // app/build.gradle
    plugins {
        id 'kotlin-kapt' // æˆ– id 'androidx.navigation.safeargs.kotlin' å¦‚æœä½¿ç”¨ kotlin
        id 'com.google.dagger.hilt.android'
    }

    dependencies {
        implementation 'com.google.dagger:hilt-android:2.51.1'
        kapt 'com.google.dagger:hilt-compiler:2.51.1'
        // ... å…¶ä»–ä¾èµ–
    }
    ```

2.  **åœ¨ Application ç±»ä¸Šæ·»åŠ  `@HiltAndroidApp`ï¼š**

    ```kotlin
    import android.app.Application
    import dagger.hilt.android.HiltAndroidApp

    // di/MyApplication.kt
    @HiltAndroidApp // Hilt çš„å…¥å£ç‚¹ï¼Œè§¦å‘ä»£ç ç”Ÿæˆ
    class MyApplication : Application() {
        // é€šå¸¸ä¸éœ€è¦åœ¨è¿™é‡Œå†™é¢å¤–çš„ä»£ç ï¼ŒHilt ä¼šè‡ªåŠ¨ç®¡ç†ç»„ä»¶
    }
    ```

3.  **å®šä¹‰ä¾èµ–æ¥å£å’Œå®ç° (ä¸ Dagger ç±»ä¼¼)ï¼š**

    ```kotlin
    // repository/UserRepository.kt
    interface UserRepository {
        fun saveUser(username: String)
    }

    // repository/DatabaseUserRepository.kt
    // Hilt å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸Šç›´æ¥ä½¿ç”¨ @Inject æ¥å‘ŠçŸ¥å¦‚ä½•åˆ›å»ºå®ä¾‹
    import javax.inject.Inject
    import javax.inject.Singleton

    @Singleton // Hilt ä¹Ÿæ”¯æŒ Dagger çš„ä½œç”¨åŸŸæ³¨è§£
    class DatabaseUserRepository @Inject constructor() : UserRepository { // ğŸš€ æ„é€ å‡½æ•°æ³¨å…¥çš„æ ‡å¿—
        override fun saveUser(username: String) {
            println("Saving user $username to database.")
        }
    }
    ```

    **æ³¨æ„ï¼š** å¦‚æœ `DatabaseUserRepository` çš„æ„é€ å‡½æ•°æ²¡æœ‰å‚æ•°ï¼Œæˆ–è€…å…¶å‚æ•°éƒ½å¯ä»¥è¢« Hilt è‡ªåŠ¨æä¾›ï¼Œé‚£ä¹ˆå¯ä»¥ç›´æ¥ä½¿ç”¨ `@Inject constructor()`ã€‚å¯¹äºç¬¬ä¸‰æ–¹åº“æˆ–æ¥å£ï¼Œä»ç„¶éœ€è¦ä½¿ç”¨ `@Module` å’Œ `@Provides`ã€‚

4.  **å®šä¹‰ Hilt æ¨¡å—ï¼ˆé’ˆå¯¹æ¥å£æˆ–å¤–éƒ¨ç±»ï¼‰ï¼š**

    ```kotlin
    import dagger.Binds
    import dagger.Module
    import dagger.hilt.InstallIn
    import dagger.hilt.components.SingletonComponent
    import javax.inject.Singleton

    // di/AppModule.kt
    @Module
    @InstallIn(SingletonComponent::class) // ğŸš€ æŒ‡å®šæ¨¡å—å®‰è£…åˆ°å“ªä¸ª Hilt ç»„ä»¶ï¼ˆä¾‹å¦‚ Application çº§åˆ«ï¼‰
    abstract class AppModule { // ä½¿ç”¨ abstract class å¯ä»¥æ›´é«˜æ•ˆåœ°ç»‘å®šæ¥å£
        @Binds // ğŸš€ ç»‘å®šæ¥å£åˆ°å…·ä½“å®ç°
        @Singleton
        abstract fun bindUserRepository(impl: DatabaseUserRepository): UserRepository
    }
    ```

5.  **åœ¨ Android ç»„ä»¶ä¸Šä½¿ç”¨ `@AndroidEntryPoint` å’Œ `@Inject`ï¼š**

    ```kotlin
    import androidx.appcompat.app.AppCompatActivity
    import android.os.Bundle
    import dagger.hilt.android.AndroidEntryPoint
    import javax.inject.Inject

    // activity/MainActivity.kt
    @AndroidEntryPoint // ğŸš€ æ ‡è®°è¿™æ˜¯ä¸€ä¸ª Hilt å…¥å£ç‚¹ï¼ŒHilt ä¼šä¸ºå®ƒç”Ÿæˆç»„ä»¶å¹¶æ³¨å…¥ä¾èµ–
    class MainActivity : AppCompatActivity() {

        @Inject // ğŸš€ è‡ªåŠ¨æ³¨å…¥ UserRepository å®ä¾‹
        lateinit var userRepository: UserRepository

        override fun onCreate(savedInstanceState: Bundle?) {
            super.onCreate(savedInstanceState)
            setContentView(R.layout.activity_main)

            userRepository.saveUser("Charlie")
            println("User Charlie saved from MainActivity.")
        }
    }
    ```

Hiltå…·æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š

* **é›†æˆåº¦é«˜ï¼š** ä¸ Android æ¡†æ¶ç»„ä»¶ï¼ˆActivity, Fragment, ViewModel, Service ç­‰ï¼‰æ— ç¼é›†æˆï¼Œè‡ªåŠ¨ç”Ÿæˆ Dagger ç»„ä»¶ã€‚
* **æ˜“ç”¨æ€§ï¼š** æ˜¾è‘—é™ä½äº† Dagger çš„å­¦ä¹ æ›²çº¿å’Œä½¿ç”¨é—¨æ§›ã€‚
* **Google å®˜æ–¹æ”¯æŒï¼š** ä½œä¸ºå®˜æ–¹æ¨èçš„ DI è§£å†³æ–¹æ¡ˆï¼ŒHilt åœ¨æœªæ¥çš„å‘å±•å’Œç»´æŠ¤ä¸Šæ›´æœ‰ä¿éšœã€‚
* **ä¿ç•™ Dagger ä¼˜åŠ¿ï¼š** ä¾ç„¶æ˜¯ç¼–è¯‘æ—¶æ³¨å…¥ï¼Œæ‹¥æœ‰ Dagger çš„é«˜æ€§èƒ½å’Œç±»å‹å®‰å…¨ã€‚

Hilt è¿…é€Ÿæˆä¸º Android DI çš„â€œæ–°å® â€ï¼Œå°¤å…¶é€‚åˆæ–°é¡¹ç›®å’Œå¸Œæœ›ç®€åŒ– Dagger é…ç½®çš„ç°æœ‰é¡¹ç›®ã€‚åœ¨ `nowinandroid` ä¸­ä½¿ç”¨ï¼Œä¹Ÿä»£è¡¨äº†å®ƒæ˜¯å½“å‰å®˜æ–¹è®¤ä¸ºçš„ Android ä¾èµ–æ³¨å…¥çš„æœ€ä½³å®è·µã€‚
## Koinï¼šè¿è¡Œæ—¶æ³¨å…¥çš„è½»é‡çº§é€‰æ‹©
éšç€ Kotlin åœ¨ Android é¢†åŸŸçš„å´›èµ·ï¼Œåˆå‡ºç°äº†ä¸€äº›çº¯ Kotlin ç¼–å†™çš„ DI æ¡†æ¶ã€‚å…¶ä¸­ï¼Œ**Koin** åœ¨ 2017 å¹´å·¦å³è„±é¢–è€Œå‡ºã€‚

Koin é‡‡å–äº†ä¸ Dagger å®Œå…¨ä¸åŒçš„ç­–ç•¥ï¼Œå®ƒæ˜¯ä¸€ä¸ª**è¿è¡Œæ—¶**ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼Œä¸ä½¿ç”¨æ³¨è§£å¤„ç†å™¨ï¼Œè€Œæ˜¯åˆ©ç”¨ Kotlin çš„ DSLï¼ˆé¢†åŸŸç‰¹å®šè¯­è¨€ï¼‰æ¥å£°æ˜ä¾èµ–ã€‚Koin åœ¨è¿è¡Œæ—¶é€šè¿‡ Kotlin çš„ DSL è§£æä¾èµ–å…³ç³»ï¼Œä¸ä¾èµ–åå°„æˆ–æ³¨è§£å¤„ç†å™¨ï¼Œé¿å…äº† Dagger çš„ç¼–è¯‘æ—¶ä»£ç ç”Ÿæˆå¤æ‚æ€§ï¼Œå¯åŠ¨é€Ÿåº¦æ›´å¿«ã€‚

Koin é™¤äº†ä½¿ç”¨ä¸Šè½»é‡åŒ–ï¼Œè¿˜å…·æœ‰ä»¥ä¸‹ä¼˜ç‚¹ï¼šå®ƒçš„é…ç½®ç®€å•ï¼Œå­¦ä¹ æ›²çº¿å¹³ç¼“ï¼Œå‡ ä¹æ²¡æœ‰æ ·æ¿ä»£ç ã€‚ä¸ Kotlin è¯­è¨€ç‰¹æ€§æ— ç¼é›†æˆï¼Œä»£ç ç®€æ´ã€‚ç”±äºæ²¡æœ‰æ³¨è§£å¤„ç†ï¼Œç¼–è¯‘é€Ÿåº¦é€šå¸¸æ¯” Dagger æ›´å¿«ã€‚

åŒæ—¶ï¼ŒKoin ç”±äºè¿è¡Œæ—¶ç”Ÿæˆçš„ç‰¹ç‚¹ï¼Œå¦‚æœ**æœ‰äº›ä¾èµ–é…ç½®å‡ºé”™ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶æ‰å¯ä»¥å‘ç°**ã€‚

Koin é‡‡ç”¨ Kotlin DSLï¼Œä¸éœ€è¦æ³¨è§£å¤„ç†å™¨ã€‚

**æ­¥éª¤ï¼š**

1.  **å®šä¹‰ä¾èµ–æ¥å£å’Œå®ç° (ä¸ Dagger ç±»ä¼¼)ï¼š**
    ```kotlin
    // repository/UserRepository.kt
    interface UserRepository {
        fun saveUser(username: String)
    }

    // repository/DatabaseUserRepository.kt
    class DatabaseUserRepository : UserRepository {
        override fun saveUser(username: String) {
            println("Saving user $username to database.")
        }
    }
    ```
2.  **å®šä¹‰ Koin æ¨¡å—ï¼š**
    ```kotlin
    import org.koin.dsl.module

    // di/appModule.kt
    val appModule = module {
        // single è¡¨ç¤ºå•ä¾‹ï¼Œget() ä¼šè‡ªåŠ¨è§£æå¹¶æä¾›æ‰€éœ€çš„ä¾èµ–
        single<UserRepository> { DatabaseUserRepository() }
    }
    ```
3.  **å®šä¹‰éœ€è¦ä¾èµ–çš„ç±»ï¼š**
    ```kotlin
    import org.koin.core.component.KoinComponent
    import org.koin.core.component.inject

    // presenter/MyPresenterWithKoin.kt
    class MyPresenterWithKoin : KoinComponent { // å®ç° KoinComponent æ¥å£
        // ğŸš€ é€šè¿‡ inject() å§”æ‰˜å±æ€§æ¥è·å–ä¾èµ–
        private val userRepository: UserRepository by inject()

        fun registerUser(username: String) {
            userRepository.saveUser(username)
            println("User $username registered.")
        }
    }
    ```
4.  **åœ¨ Application æˆ– Main æ–¹æ³•ä¸­å¯åŠ¨ Koinï¼š**
    ```kotlin
    import org.koin.core.context.startKoin
    import org.koin.core.context.stopKoin

    // main/MainKoin.kt
    fun main() {
        // âœ¨ å¯åŠ¨ Koin ä¸Šä¸‹æ–‡ï¼Œå¹¶åŠ è½½æ¨¡å—
        startKoin {
            modules(appModule)
        }

        val presenter = MyPresenterWithKoin()
        presenter.registerUser("Bob")

        stopKoin() // æ¸…ç† Koin ä¸Šä¸‹æ–‡
    }
    ```

Koin çš„æ ¸å¿ƒä¼˜åŠ¿åœ¨äº â€‹â€‹ç®€æ´æ€§â€‹â€‹ å’Œ â€‹â€‹Kotlin åŸç”Ÿæ”¯æŒâ€‹â€‹ï¼Œé€šè¿‡ DSL å’Œè¿è¡Œæ—¶è§£æé™ä½äº† DI çš„å­¦ä¹ æˆæœ¬ï¼Œé€‚åˆè¿½æ±‚å¼€å‘æ•ˆç‡çš„é¡¹ç›®ã€‚ä½†å¯¹äºè¶…å¤§å‹åº”ç”¨æˆ–å¯¹æ€§èƒ½æåº¦æ•æ„Ÿçš„åœºæ™¯ï¼Œå¯èƒ½éœ€è¦æƒè¡¡å…¶è¿è¡Œæ—¶è§£æçš„å¼€é”€ã€‚å¦‚æœä½ æ­£åœ¨ä½¿ç”¨ Kotlin å¼€å‘ Android æˆ–åç«¯æœåŠ¡ï¼ŒKoin æ˜¯ä¸€ä¸ªå€¼å¾—å°è¯•çš„è½»é‡çº§ DI æ–¹æ¡ˆã€‚

ç°å¦‚ä»Šï¼Œ`Kotlin Multiplatform` è·¨å¹³å°çš„è¿…é€Ÿå‘å±•ï¼Œ`Koin` ä¹Ÿæ¨å‡ºäº†å…¶è·¨å¹³å°ç‰ˆæœ¬ï¼Œåœ¨ **Androidï¼ŒIOSï¼ŒDesktopå’Œ web ç«¯** çš„Kotlinè·¨å¹³å°é¡¹ç›®é‡Œï¼Œéƒ½å¯ä»¥åŠ©åŠ›å¼€å‘è€…å®ç°ä¾èµ–æ³¨å…¥ï¼Œæ”¯æŒåŠŸèƒ½çš„å¿«é€Ÿå¼€å‘ã€‚
