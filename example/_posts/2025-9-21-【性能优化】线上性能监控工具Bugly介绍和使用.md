---
layout: post
description: > 
  本文介绍了线上性能监控工具Bugly的介绍和使用。
image: 
  path: /assets/img/blog/blogs_performance.png
  srcset: 
    1920w: /assets/img/blog/blogs_performance.png
    960w:  /assets/img/blog/blogs_performance.png
    480w:  /assets/img/blog/blogs_performance.png
accent_image: /assets/img/blog/blogs_performance.png
excerpt_separator: <!--more-->
sitemap: false
---
# 【性能优化】线上性能监控工具Bugly介绍和使用
腾讯的 **Bugly** 是一款专注于移动端和 PC 端应用的 **线上崩溃监控、性能监控与异常分析** 的一站式工具，广泛应用于移动应用（Android/iOS）以及小游戏、小程序等平台。它帮助开发者实时发现、定位和修复线上应用中的崩溃、卡顿、ANR（Application Not Responding）、内存泄漏等问题，从而提升应用稳定性与用户体验。

下面从 **原理、设计架构、使用方式** 三个方面详细介绍 Bugly：

---

## 一、Bugly 原理

### 1. 数据采集原理

Bugly 的核心功能依赖于对应用运行时数据的 **实时采集与上报**，主要包括以下几类数据：

#### （1）崩溃（Crash）信息采集
- 当应用发生 **未捕获的异常（如 Java 的 Throwable、Objective-C 的 NSException、C++ 的 Signal/Exception）** 时，Bugly SDK 会通过 **全局异常捕获机制** 拦截这些异常。
- 捕获到的异常信息包括：
  - 崩溃堆栈（Call Stack）
  - 崩溃类型（Java Crash / Native Crash / ANR / OOM 等）
  - 崩溃线程信息
  - 设备信息（型号、系统版本、CPU 架构等）
  - 应用信息（版本号、渠道、包名等）
  - 用户信息（可选，如用户 ID、登录态）

#### （2）ANR（应用无响应）监控
- 在 Android 上，Bugly 通过监听 `/data/anr/traces.txt` 文件或使用 **FileObserver** 监听 ANR 日志文件变化，或者通过 **Looper 监听主线程卡顿超时** 来检测 ANR。
- 在 iOS 上，通过监控主线程 RunLoop 状态，判断是否长时间未响应。

#### （3）卡顿（卡顿监控 / 卡顿率）
- 通过在一定时间间隔内监测主线程的消息处理时长，如果超过设定的阈值（如 500ms 或 1s），则认为发生了一次卡顿，记录调用堆栈。
- 支持统计卡顿次数、卡顿时长、卡顿率等指标。

#### （4）内存相关监控
- 包括 **OOM（Out Of Memory）崩溃** 监控、**内存泄漏检测（部分高级功能）**、内存使用量趋势等。

#### （5）自定义异常 / 日志
- 开发者可以手动调用 Bugly SDK 接口，上报自定义的异常、业务错误或关键日志，便于排查特定业务问题。

---

### 2. 数据传输与上报机制

- **本地缓存 + 批量上报**：SDK 会将采集到的数据先缓存在本地（如 SQLite 或文件），在网络可用时（如 Wi-Fi 或移动网络）进行批量压缩加密后上传到 Bugly 服务器。
- **断点续传 & 异常重试**：如果上传失败，数据会在下次启动或网络恢复时自动重试，确保数据不丢失。
- **实时性**：大部分崩溃数据可在 **几分钟内** 展示在 Bugly 后台，供开发者及时查看与分析。

---

### 3. 符号化（Symbolication）

- 对于 **Native 崩溃（C/C++）**，崩溃堆栈通常是经过编译器优化的地址，无法直接阅读。Bugly 通过上传 **符号表文件（如 dSYM / SO 符号文件）**，在服务端进行 **符号还原（Symbolication）**，将地址转换为具体的函数名、文件名与行号，极大地方便定位问题。
- 开发者需要在每次发布新版本时，**上传对应的符号表**，否则 Native 崩溃堆栈可能难以解析。

---

## 二、Bugly 设计架构

Bugly 的整体架构可以分为 **客户端 SDK、数据传输层、服务端平台** 三大部分：

### 1. 客户端 SDK（集成在 App 中）

负责在用户设备上 **实时监控、采集各种异常和性能数据**，包括：

- 崩溃捕获模块
- ANR 监控模块
- 卡顿检测模块
- 内存监控模块
- 数据本地存储与上报模块
- 用户行为与自定义事件上报接口

SDK 具有如下特点：

- **轻量级、低侵入、高性能**：对应用本身的性能影响极小，启动速度快，运行时 CPU/内存开销低。
- **多平台支持**：支持 Android、iOS、微信小程序、Unity、Cocos 等平台。
- **灵活配置**：开发者可以控制监控粒度，比如是否开启卡顿监控、ANR 监控，设置卡顿阈值等。

---

### 2. 数据传输层

- 负责将客户端采集的数据安全、可靠地传输到 Bugly 云端服务器。
- 包括数据加密、压缩、断点续传、重试机制等。
- 支持离线缓存，在网络恢复后自动同步。

---

### 3. 服务端平台（Bugly 控制台）

这是开发者日常使用 Bugly 的主要入口，提供以下功能：

#### （1）崩溃分析
- 实时展示 Crash 数量、影响用户数、崩溃率等关键指标。
- 提供详细的崩溃堆栈、设备信息、用户信息、出现趋势图等。
- 支持按版本、时间、设备等维度筛选与分析。
- **支持 Native 崩溃符号化展示**，精准定位问题代码。

#### （2）ANR 分析
- 展示 ANR 发生次数、影响用户、堆栈信息等。
- 支持 ANR 日志下载与分析。

#### （3）卡顿分析
- 统计卡顿次数、卡顿时长、影响用户等。
- 提供卡顿堆栈，帮助优化主线程性能。

#### （4）性能监控（高级版）
- 包括启动耗时、页面渲染耗时、网络请求耗时等性能指标的监控与分析。

#### （5）用户反馈与自定义监控
- 支持用户反馈收集、自定义异常、日志上传、业务指标监控等。

#### （6）报警与通知
- 支持设置崩溃率、ANR 阈值等报警策略，通过邮件、企业微信、钉钉等方式通知开发者。

#### （7）多团队协作与权限管理**
- 支持不同团队成员拥有不同权限，如只读、上传符号表、管理项目等。

---

## 三、Bugly 使用方式

### 1. 接入方式

Bugly 提供了非常便捷的 SDK 接入流程，支持主流开发语言与平台：

#### （1）Android 接入
- 在项目的 `build.gradle` 中引入 Bugly SDK 依赖。
- 初始化 Bugly（一般在 Application 的 onCreate 方法中）：
  ```java
  CrashReport.initCrashReport(getApplicationContext(), "你的AppID", false);
  ```
- 可选：配置是否开启 Debug 模式、自动上传符号表等。

#### （2）iOS 接入
- 通过 CocoaPods 或手动方式集成 Bugly SDK。
- 在 AppDelegate 中初始化：
  ```objc
  [Bugly startWithAppId:@"你的AppID"];
  ```
- 支持 Swift 项目。

#### （3）其他平台
- Unity、Cocos、微信小程序、H5 等平台均有对应的接入文档与 SDK。

---

### 2. 符号表上传

- **Android**：需要上传 **dSYM 文件（或对应映射文件）**，通常从构建系统中自动上传（如 Jenkins 插件、Gradle 脚本）。
- **iOS**：必须上传 **dSYM 文件**，每次 App 发布新版本后都要上传，否则 Native 崩溃无法解析。
- Bugly 提供了 **自动符号表上传脚本 / 插件**，也支持手动上传。

---

### 3. 控制台使用

登录 https://bugly.qq.com/ 后：

1. 选择对应的项目（App）。
2. 查看 **崩溃、ANR、卡顿、性能** 等核心监控数据。
3. 点击某个崩溃，可查看：
   - 崩溃概览（影响用户数、次数、版本分布等）
   - 堆栈详情（支持符号化）
   - 设备信息、用户信息
   - 时间趋势图
4. 使用筛选、搜索功能快速定位问题。
5. 配置报警、用户反馈、自定义监控等高级功能。

---

## 四、Bugly 的优势

| 特性 | 说明 |
|------|------|
| **实时性强** | 崩溃数据几分钟内可查看 |
| **符号化精准** | 支持 Native 崩溃还原，精准定位代码行 |
| **多平台支持** | Android、iOS、小程序、Unity、Cocos 等 |
| **低侵入性** | SDK 轻量，对性能影响极小 |
| **丰富的分析维度** | 支持按版本、设备、用户等筛选分析 |
| **报警与协作** | 支持自定义报警、团队协作、权限管理 |
| **免费+增值服务** | 基础功能免费，高级功能（如全量性能监控）收费 |

---

## 五、总结

腾讯 Bugly 是一个功能全面、稳定可靠的 **移动端/PC 端线上质量监控平台**，其核心原理是通过 SDK 捕获应用运行时的各类异常与性能问题，经过本地处理和加密上传，最终通过云端平台为开发者提供可视化分析、报警、符号化解析和问题定位能力。

对于希望提升应用稳定性、快速发现并解决线上崩溃和性能问题的团队来说，Bugly 是非常实用的工具，尤其适合中小型团队及大型互联网公司使用。
