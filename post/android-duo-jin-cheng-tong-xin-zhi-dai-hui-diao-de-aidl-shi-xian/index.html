<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Androidå¤šè¿›ç¨‹é€šä¿¡ä¹‹å¸¦å›è°ƒçš„AIDLå®ç° | Stephen&#39;s Personal Page</title>
<meta name="description" content="åœ¨è¡Œä¸­çŸ¥ï¼Œåœ¨çŸ¥ä¸­è¡Œ" />
<link rel="shortcut icon" href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/favicon.ico">
<link rel="stylesheet" href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/styles/main.css">

<script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/jquery.min.js"></script>
<script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/masonry.pkgd.min.js"></script>
<script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/aos.js"></script>
<script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/pace.min.js"></script>
<script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/view-image.min.js"></script>
<script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/jquery.magnific-popup.min.js"></script>
<script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/functions.js"></script>
    <meta name="referrer" content="never">
    <meta name="description" content="éœ€æ±‚èƒŒæ™¯
æˆ‘ä»¬éƒ½çŸ¥é“Androidç³»ç»Ÿçš„IPC(å¤šè¿›ç¨‹é€šä¿¡)æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œåƒå…¨å±€å¹¿æ’­ï¼Œç³»ç»Ÿæ•°æ®åº“ç›‘å¬ï¼Œè¿˜æœ‰æœ€å¹¿ä¸ºä½¿ç”¨çš„AIDLæ¥å£ã€‚
æœ€è¿‘æˆ‘æ”¶åˆ°äº†æ¥è‡ªè¯­éŸ³appçš„éœ€æ±‚ï¼Œä»–ä»¬ä¸ºäº†å¯ä»¥é¡ºåˆ©æ³¨å†Œå¯è§å³å¯è¯´ï¼ˆæ‰«ææ¨¡æ‹Ÿç‚¹å‡»ï¼‰ï¼Œéœ€è¦æˆ‘åœ¨æ‰“å¼€å’Œå…³é—­ç•Œé¢çš„..." />
    <meta name="keywords" content="Android" />
    <script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/waterfall.min.js"></script>
    <script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/prism.min.js"></script>
  </head>
  <body>
            <header id="header" class="grid-container">
        <!-- start: .menu-wrapper -->
        <div class="menu-mobile"> 
          <i class="fa fa-reorder"></i>
        </div>
        <div class="menu-wrapper">
          <div class="">
            <div class="logo">
              <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io"><img src="/media/images/logoo.png" alt=""></a>
            </div>
            <!-- start: .main-nav -->

            <nav class="main-nav grid-container grid-parent">
              <ul id="menu-header" class="menu gradient-effect">
                <li class=""><a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io" class="menu">é¦–é¡µ</a></li>
                
                  <li class="" >
                    <a href="/" class="menu">
                      é¦–é¡µ
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/archives" class="menu">
                      å½’æ¡£
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/tags" class="menu">
                      æ ‡ç­¾
                    </a>
                  </li>
                
                  <li class="" >
                    <a href="/post/about" class="menu">
                      å…³äº
                    </a>
                  </li>
                
                <li class="search-menu-item hide-on-mobile hide-on-tablet"><a href="#search-lightbox" class="lightbox mfp-inline"><i class="fa fa-search-line"></i></a></li>
              </ul>
            </nav>
            <a href="#search-lightbox" class="lightbox epcl-search-button mfp-inline hide-on-tablet hide-on-desktop"><i class="fa fa-search-line"></i></a>
            <!-- end: .main-nav -->
            <div class="clear"></div>
            <div class="border hide-on-tablet hide-on-mobile"></div>
          </div>    
          <div class="clear"></div>
        </div>
        <!-- end: .menu-wrapper -->
        <div class="clear"></div>
      </header>
      <div class="hide-on-mobile hide-on-tablet hide-on-desktop">
        <div id="search-lightbox" class="grid-container grid-small grid-parent mfp-hide">
          <div class="search-wrapper section">
            <form id="gridea-search-form" data-update="1735025099700" action="/search/index.html" class="search-form" _lpchecked="1">
              <input type="text" name="q" id="s" value="" class="search-field" placeholder="æœç‚¹å•¥..." aria-label="æœç‚¹å•¥..." required="">
              <button type="submit" class="submit" aria-label="Submit">
                <i class="fa fa-search-line"></i>
              </button>
            </form>
          </div>
        </div>
      </div>

      <main id="single" class="main grid-container fullcover no-sidebar aos-init aos-animate" data-aos="fade">

        <div class="center content">
          <div class="featured-image cover" style="background-image: url('https://github.com/stepheneasyshot/stepheneasyshot.github.io/post-images/android-duo-jin-cheng-tong-xin-zhi-dai-hui-diao-de-aidl-shi-xian.jpg');">
            <div class="meta top"> 
              <time class="meta-info" style="float:left;" datetime="2024-06-04"><i class="fa fa-calendar"></i><span class="lately">7 ä¸ªæœˆå‰</span></time>
              
              <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-duo-jin-cheng-tong-xin-zhi-dai-hui-diao-de-aidl-shi-xian/#comments" class="comments meta-info" title="">
                <i class="fa fa-comment remixicon"></i><span class="comment-count valine-comment-count" data-xid="/android-duo-jin-cheng-tong-xin-zhi-dai-hui-diao-de-aidl-shi-xian/"> </span>
              </a>
              <span id="/android-duo-jin-cheng-tong-xin-zhi-dai-hui-diao-de-aidl-shi-xian/" class="leancloud_visitors views-counter meta-info" title=""><i class="fa fa-leancloud remixicon"></i><span class="leancloud-visitors-count"></span></span>
              
            </div>
            <div class="info">
              <div class="tags ">
                
                      <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/tag/5yQtIxh3Hz/" class="ctag ctag-0 ctag-5yQtIxh3Hz" aria-label="">Android</a>
                    
              </div>
              <h1 class="title ularge white bold">Androidå¤šè¿›ç¨‹é€šä¿¡ä¹‹å¸¦å›è°ƒçš„AIDLå®ç°</h1>
            </div>
          </div>
        </div>  

        <div class="epcl-page-wrapper">
          <div class="left-content grid-70 np-mobile">
            <article class="main-article post">
              <section class="post-content">
                <div class="text">
                  <h1 id="éœ€æ±‚èƒŒæ™¯">éœ€æ±‚èƒŒæ™¯</h1>
<p>æˆ‘ä»¬éƒ½çŸ¥é“Androidç³»ç»Ÿçš„IPC(å¤šè¿›ç¨‹é€šä¿¡)æ–¹å¼æœ‰å¾ˆå¤šç§ï¼Œåƒå…¨å±€å¹¿æ’­ï¼Œç³»ç»Ÿæ•°æ®åº“ç›‘å¬ï¼Œè¿˜æœ‰æœ€å¹¿ä¸ºä½¿ç”¨çš„AIDLæ¥å£ã€‚</p>
<p>æœ€è¿‘æˆ‘æ”¶åˆ°äº†æ¥è‡ªè¯­éŸ³appçš„éœ€æ±‚ï¼Œä»–ä»¬ä¸ºäº†å¯ä»¥é¡ºåˆ©æ³¨å†Œå¯è§å³å¯è¯´ï¼ˆæ‰«ææ¨¡æ‹Ÿç‚¹å‡»ï¼‰ï¼Œéœ€è¦æˆ‘åœ¨æ‰“å¼€å’Œå…³é—­ç•Œé¢çš„æ—¶å€™ç»™ä»–ä»¬å‘ä¸ªé€šçŸ¥ã€‚å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨æ˜¯é‡‡ç”¨windowmanageræ·»åŠ çš„ä¸€ä¸ªä¸´æ—¶å¼¹çª—ï¼Œä¸èƒ½é€šè¿‡ActivityStackæ ˆç›‘å¬åˆ°å˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦åšè¿™ä¹ˆä¸€ä¸ªæ¥å£ç»™ä»–ä»¬ã€‚</p>
<p>ç”±äºä¹‹å‰å·²ç»ç»™è¯­éŸ³ä¾§æ‰“åŒ…è¿‡AIDLä¾èµ–åŒ…ï¼Œæä¾›è¿‡æ‰“å¼€å…³é—­ç•Œé¢ï¼Œè·å–æ¨¡å¼çŠ¶æ€ç­‰æ¥å£äº†ï¼Œæ‰€ä»¥å¸Œæœ›åŸºäºå·²æœ‰çš„æ¥å£ä¸Šè¿›è¡Œæ‰©å±•ï¼Œä½¿ç”¨æ³¨å†Œç›‘å¬çš„å½¢å¼æ¥ç»™ä»–ä»¬å‘å›è°ƒé€šçŸ¥ï¼Œå‘Šè¯‰ä»–ä»¬ç•Œé¢çŠ¶æ€æœ‰å˜åŠ¨ã€‚</p>
<p>åˆšç€æ‰‹å‡†å¤‡åšï¼Œçªç„¶æƒ³èµ·æ¥è¿™ä¸ªå¸¦å›è°ƒçš„AIDLæ¥å£å¥½åƒä¹‹å‰è¿˜æ²¡æœ‰å¼€å‘è¿‡ï¼Œäºæ˜¯ç®€å•çœ‹äº†ä¸‹ï¼Œè®°å½•ä¸‹å¼€å‘è¿‡ç¨‹ã€‚ä¸å¾—ä¸æ„Ÿå¹è°·æ­ŒçœŸçš„æ‡’ï¼Œè¿™å¥—AIDLçš„å†™æ³•ï¼Œæ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹ç¹çã€‚å…‰è®°å½•è¿™ä¸ªåŠ å›è°ƒAIDLæ–¹æ³•çš„è¿‡ç¨‹å®åœ¨å¤ªçŸ­äº†ï¼Œè¿™é‡Œå°†æˆ‘ç»™å¤–éƒ¨appæä¾›ä¾èµ–åŒ…çš„ä¹ æƒ¯ä¹Ÿä¸€èµ·è®°å½•ä¸‹å§ã€‚</p>
<h1 id="ä»¥aarçš„å½¢å¼æä¾›aidlæ¥å£">ä»¥aarçš„å½¢å¼æä¾›AIDLæ¥å£</h1>
<p>Googleå®˜æ–¹çš„ä¾‹ç¨‹ä¸€èˆ¬æ˜¯ï¼Œä½œä¸ºæœåŠ¡ç«¯çš„appå’Œä½œä¸ºå®¢æˆ·ç«¯çš„appä¸¤è¾¹å»ºç«‹ä¸€ä¸ªåŒæ ·åŒ…åçš„AIDLæ–‡ä»¶å¤¹ï¼Œå®¢æˆ·ç«¯å†å»è‡ªå·±åšä¸€ä¸ªbindServiceçš„æ“ä½œï¼Œè¿æ¥æˆåŠŸæ—¶ï¼Œç”¨è¿”å›æ¥çš„binderå¯¹è±¡å°†æœåŠ¡ç»™å®ä¾‹åŒ–ï¼Œä½¿ç”¨å…¶ä¸­çš„æ–¹æ³•ã€‚ä½†æ˜¯å°±æ‹¿è¯­éŸ³è·ç¦»ï¼Œå¤§å®¶éƒ½è¿™ä¹ˆç»™è¯­éŸ³å®¢æˆ·ç«¯æä¾›æ¥å£çš„è¯ï¼Œä»–ä»¬é‚£è¾¹çš„é¡¹ç›®å¤æ‚åº¦è¦çˆ†ç‚¸äº†ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯ç”±æä¾›æ¥å£çš„Serverç«¯å°†å®¢æˆ·ç«¯è¿æœåŠ¡çš„æ“ä½œä¹Ÿè‡ªå·±å®ç°äº†ï¼Œä½œä¸ºä¸€ä¸ªæœ¬åœ°çš„libraryæ¨¡ç»„ï¼Œä¸€èµ·æ‰“ä¸€ä¸ªaaråŒ…æä¾›å‡ºå»ã€‚</p>
<p>æ¥ä¸‹æ¥ä»¥ä¸¤ä¸ªDemoçš„ä»£ç ç¤ºä¾‹æ¼”ç¤ºä¸‹è¿™ä¸ªæ‰“åŒ…çš„æµç¨‹ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ªè½¦é€Ÿæ¨¡æ‹Ÿçš„éœ€æ±‚ä¸ºä¾‹:</p>
<h2 id="æ–°å»ºæ¨¡ç»„é…ç½®gradle">æ–°å»ºæ¨¡ç»„é…ç½®gradle</h2>
<p>åœ¨é¡¹ç›®é‡Œnewä¸€ä¸ªModuleï¼Œè®°å¾—é€‰æ‹©Libraryç±»å‹ï¼ŒASä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬å¡«åˆ°setting.gradle.ktsä¸­ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ–°moduleçš„gradleæ„å»ºé…ç½®ä¸­å¼€å¯aidlï¼Œè¿™æ ·æ‰èƒ½æ–°å»ºaidlæ¥å£å£°æ˜æ–‡ä»¶ã€‚ç¬¬äºŒä¸ªæ”¹åŠ¨å°±æ˜¯é…ç½®æ„å»ºè¾“å‡ºæ–‡ä»¶åã€‚</p>
<pre><code>buildFeatures {
    aidl = true
}
 
 
val aarName = &quot;CarSpeedMock&quot;
android.libraryVariants.configureEach {
    outputs.all {
        if (this is com.android.build.gradle.internal.api.LibraryVariantOutputImpl) {
            this.outputFileName = &quot;${aarName}_1.0.aar&quot;
        }
    }
}
</code></pre>
<p>è¿™æ ·æˆ‘ä»¬åœ¨æ‰“åŒ…çš„æ—¶å€™å°±å¯ä»¥é¡ºåˆ©ç”Ÿæˆä¸€ä¸ªaarä¾èµ–åŒ…çš„è¾“å‡ºæ–‡ä»¶ï¼Œå°†è¿™ä¸ªä¾èµ–åŒ…æä¾›ç»™æ¥å£ä½¿ç”¨æ–¹ï¼Œå¯ä»¥å¤§å¤§ç®€åŒ–ä»–ä»¬çš„å·¥ä½œé‡ï¼Œè§£è€¦ä»£ç ï¼Œå¯å¢å¼ºå¯ç»´æŠ¤æ€§ã€‚</p>
<h1 id="å¼€å§‹å®ç°aidlæ¥å£å›è°ƒéœ€æ±‚">å¼€å§‹å®ç°AIDLæ¥å£å›è°ƒéœ€æ±‚</h1>
<h2 id="é…ç½®serverä¸clientä»£ç†çš„aidlæ–‡ä»¶">é…ç½®Serverä¸Clientä»£ç†çš„aidlæ–‡ä»¶</h2>
<p>æˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿä¸€ä¸‹è½¦é€Ÿæ•°æ®çš„å›è°ƒï¼Œéœ€è¦æ–°å»ºä¸€ä¸ªä¸»è¦çš„æ¥å£å£°æ˜æ–‡ä»¶ï¼Œé‡Œé¢æ·»åŠ ä¸€ä¸ªè®¾ç½®å›è°ƒçš„æ–¹æ³•ï¼Œç„¶åéœ€è¦å†å£°æ˜ä¸€ä¸ªå›è°ƒæ¥å£ï¼Œé‡Œé¢æ˜¯onChangeçš„æ–¹æ³•ã€‚</p>
<pre><code>// ISpeedCallback.aidl
interface ISpeedCallback {
   void onSpeedChange( int speed);
}
 
// SpeedMockManager.aidl
import com.stephen.vehiclesettings.ISpeedCallback;
 
interface SpeedMockManager {
    void addSpeedCallback(ISpeedCallback callback);
}
</code></pre>
<p>ç„¶åå°†æ•´ä¸ªæ–‡ä»¶å¤¹éƒ½å¤åˆ¶åˆ°æ–°å»ºçš„æ¨¡ç»„ä¸­å»ï¼Œä¿è¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¸¤è¾¹çš„aidlæ–‡ä»¶å¤¹å®Œå…¨ç›¸åŒã€‚<br>
<img src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post-images/1717488972065.png" alt="" loading="lazy"><br>
é¡¹ç›®é‡Œçš„ä¸¤è¾¹åŒæ­¥ä¹‹åï¼Œæˆ‘ä»¬ç‚¹å‡»å°é”¤å­buildä¸€ä¸‹ï¼Œä»¥ä¾¿ASå¯ä»¥ç”Ÿæˆæ ¼å¼åŒ–çš„stubæ–‡ä»¶ã€‚</p>
<h2 id="å®ç°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é€»è¾‘">å®ç°æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é€»è¾‘</h2>
<p>åœ¨æœåŠ¡ç«¯é‡Œï¼Œæˆ‘ä»¬åœ¨onBindæ–¹æ³•é‡Œè¿”å›ä¸€ä¸ªbinderå¯¹è±¡ï¼Œå®ƒè¦å®ç° SpeedMockManager.Stubæ¥å£ï¼Œæ‰å¯ä»¥å’Œå®¢æˆ·ç«¯é¡ºåˆ©å¯¹æ¥ã€‚</p>
<p>æœåŠ¡ç«¯ä»£ç å¦‚ä¸‹:</p>
<pre><code>class SpeedMockService : Service() {
 
    override fun onCreate() {
        super.onCreate()
        infoLog()
    }
 
    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {
        infoLog()
        return super.onStartCommand(intent, flags, startId)
    }
 
    override fun onBind(intent: Intent) = object : SpeedMockManager.Stub() {
        @Throws(RemoteException::class)
        override fun addSpeedCallback(callback: ISpeedCallback?) {
            // é‡‡ç”¨åç¨‹å¾ªç¯å’Œå»¶æ—¶æ¥æ¨¡æ‹Ÿå›è°ƒè½¦é€Ÿæ•°æ®
            CoroutineScope(Dispatchers.IO).launch {
                repeat(1000) { data -&gt;
                    delay(2000L)
                    infoLog(&quot;aidl send int data: $data&quot;)
                    try {
                        // è°ƒç”¨ä¼ è¿›æ¥çš„1å›è°ƒæ¥å£çš„æ–¹æ³•ï¼Œå°†æ•°æ®è¿”å›å»
                        callback?.onSpeedChange(data)
                    } catch (e: Exception) {
                      e.printStackTrace()
                        this.cancel()
                    }
                }
            }
        }
    }
}
</code></pre>
<p>åŒæ ·çš„åœ¨å®¢æˆ·ç«¯ä»£ç†é‡Œé¢ï¼Œå»æ‰§è¡ŒbindServiceã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬çš„å®¢æˆ·ç«¯ä»£ç†ç±»é‡Œé¢ï¼Œéœ€è¦å¤šè®¾ç½®ä¸€ä¸ªè¿æ¥æœåŠ¡æˆåŠŸçš„æ¥å£ï¼Œåœ¨è¿æ¥æˆåŠŸçš„æ—¶å€™é€šçŸ¥åˆ°ä½¿ç”¨æ–¹ï¼Œæˆ‘ä»¬çš„æœåŠ¡è¿™æ—¶å€™ç»‘å®šæˆåŠŸäº†ï¼Œä»¥åå¯ä»¥ä½¿ç”¨é‡Œé¢çš„æ–¹æ³•äº†ã€‚</p>
<p>å®¢æˆ·ç«¯ä»£ç†ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><code>object CarSpeedProxy {
 
    private const val TAG = &quot;CarSpeedProxy&quot;
 
    private lateinit var carspeedManager: SpeedMockManager
 
    fun init(context: Context, connectListener: CarSpeedServiceConnectListener) {
        context.bindService(Intent(&quot;com.stephen.vehiclesettings.service.SpeedMockService&quot;).apply {
            setPackage(&quot;com.stephen.vehiclesettings&quot;)
        }, object : ServiceConnection {
            override fun onServiceConnected(name: ComponentName?, service: IBinder?) {
                Log.i(TAG, &quot;onServiceConnected: name:$name&quot;)
                // æ¥å£å®ä¾‹åŒ–
                carspeedManager = SpeedMockManager.Stub.asInterface(service)
                // è¿æ¥æˆåŠŸå›è°ƒï¼Œå‘ŠçŸ¥ä½¿ç”¨æ–¹
                connectListener.onServiceConnected()
            }
 
            override fun onServiceDisconnected(name: ComponentName?) {
                Log.i(TAG, &quot;onServiceDisconnected: name:$name&quot;)
                connectListener.onServiceDisConnected()
            }
 
        }, Context.BIND_AUTO_CREATE)
    }
 
    fun addCarSpeedCallback(callback: ISpeedCallback) {
        // æ·»åŠ å›è°ƒæ¥å£ï¼Œä½¿ç”¨æ–¹å°±å¯ä»¥æ¥æ”¶æ•°æ®äº†
        try {
            carspeedManager.addSpeedCallback(callback)
        } catch (e: RemoteException) {
            e.printStackTrace()
        }
    }
 
    /**
     * æœåŠ¡è¿æ¥æ¥å£
     */
    interface CarSpeedServiceConnectListener{
        fun onServiceConnected()
        fun onServiceDisConnected()
    }
}
</code></pre>
<h1 id="éœ€æ±‚æ–¹ä½¿ç”¨aar">éœ€æ±‚æ–¹ä½¿ç”¨aar</h1>
<p>æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é€»è¾‘éƒ½å®Œæˆåï¼Œå°†è¿™ä¸ªä¾èµ–åŒ…æä¾›ç»™éœ€æ±‚æ–¹å±•å¼€è°ƒè¯•ï¼Œçœ‹çœ‹æœåŠ¡è¿æ¥å’Œæ•°æ®å›è°ƒæœ‰æ²¡æœ‰é—®é¢˜ã€‚æ³¨æ„æ­¤Demoè¿è¡Œåœ¨æˆ‘è‡ªå·±ç¼–è¯‘çš„ç³»ç»Ÿä¸­ï¼Œè€Œä¸”é…ç½®äº†ç³»ç»Ÿç­¾åï¼Œæ‹¥æœ‰Systemæƒé™ï¼Œæ‰€ä»¥ä¸ç”¨è€ƒè™‘æœåŠ¡ä¿æ´»é—®é¢˜ã€‚</p>
<p>ä½¿ç”¨è¿™ä¸ªæ¥å£çš„appï¼Œéœ€è¦å°†æˆ‘ä»¬æä¾›çš„aarä¾èµ–åŒ…æ”¾åœ¨libsæ–‡ä»¶å¤¹ä¸‹ï¼Œå¹¶åœ¨gradleé‡Œæ·»åŠ ç¼–è¯‘è·¯å¾„ã€‚è¿™é‡Œæˆ‘ä¹Ÿæ–°å»ºä¸€ä¸ªéœ€æ±‚æ–¹çš„Demoæ¥æµ‹è¯•æˆ‘ä»¬çš„aaræ˜¯å¦å·¥ä½œæ­£å¸¸ï¼Œä½¿ç”¨æˆ‘ä»¬aaré‡Œçš„å®¢æˆ·ç«¯ä»£ç†ç±»å»åˆå§‹åŒ–è¿æ¥æœåŠ¡ï¼Œæ·»åŠ å›è°ƒï¼Œå¹¶æ¥æ”¶æ¥è‡ªæœåŠ¡ç«¯æ¨¡æ‹Ÿçš„è½¦é€Ÿæ•°æ®äº†ã€‚</p>
<p>æˆ‘ä»¬åœ¨Demoé‡Œä¹Ÿä½¿ç”¨ä¸€ä¸ªå•ä¾‹ç±»æ¥ä¸“é—¨ç®¡ç†è¿™ä¸ªaarçš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿›ä¸€æ­¥è§£è€¦ã€‚åœ¨Applicationåˆå§‹åŒ–è°ƒç”¨initæ–¹æ³•è¿æ¥æœåŠ¡ï¼Œåœ¨æ­£å¼çš„ä½¿ç”¨å¤„ç¡®ä¿è¿æ¥æˆåŠŸåï¼Œå†æ·»åŠ å›è°ƒï¼Œæ‹¿å–æ•°æ®ï¼š</p>
<pre><code>object AidlCallbackTest {
 
    private var isServiceReady = false
 
    fun init() {
        CarSpeedProxy.init(appContext, object : CarSpeedProxy.CarSpeedServiceConnectListener {
            override fun onServiceConnected() {
                LogUtils.i(&quot;AidlCallbackTest&quot;, &quot;onServiceConnected&quot;)
                isServiceReady = true
            }
 
            override fun onServiceDisConnected() {
                LogUtils.i(&quot;AidlCallbackTest&quot;, &quot;onServiceDisConnected&quot;)
            }
 
        })
    }
 
    fun addCallback(callback: ISpeedCallback) {
        if (isServiceReady)
            CarSpeedProxy.addCarSpeedCallback(callback)
    }
}
</code></pre>
<p>åœ¨æ–¹æ³•è°ƒç”¨å¤„ï¼Œæˆ‘ä»¬éœ€è¦ä¼ å…¥çš„è¿™ä¸ªå›è°ƒï¼Œå³ä¸€ä¸ªåŒ¿åå†…éƒ¨ç±»ç»§æ‰¿è‡ªISpeedCallback.Stubï¼Œå®ç°å®ƒçš„onSpeedChange(a:Int)å›è°ƒæ–¹æ³•ï¼Œå°±å¯ä»¥æ¥æ”¶åˆ°æ•°æ®äº†ï¼š</p>
<pre><code>AidlCallbackTest.addCallback(object : ISpeedCallback.Stub() {
    override fun onSpeedChange(speedData: Int) {
        LogUtils.i(TAG, &quot;onSpeedChange speed:$speedData&quot;)
    }
})
</code></pre>
<p>å…ˆrunè¿›å»æœåŠ¡ç«¯ï¼Œå†runåˆšåˆšå†™çš„å®¢æˆ·ç«¯ï¼Œä¸¤ä¸ªè¿›ç¨‹éƒ½è¿è¡Œèµ·æ¥åï¼ŒæŸ¥çœ‹ASçš„Logæ‰“å°æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœåŠ¡æˆåŠŸè¿æ¥äº†ã€‚å†ç‚¹å‡»Demoçš„æŒ‰é’®æ·»åŠ ä¸Šcallbackå›è°ƒï¼Œå¯ä»¥çœ‹åˆ°Serverå’ŒClientä¸¤è¾¹çš„æ¨¡æ‹Ÿæ•°æ®çš„æ‰“å°ä¹Ÿéƒ½æ‰“å°å‡ºæ¥äº†ï¼Œè®¾å¤‡ä¸åœ¨æ‰‹è¾¹å°±ä¸å†æˆªå›¾äº†ã€‚</p>
<p>è¿™æ ·ä¸€ä¸ªå¸¦å›è°ƒçš„AIDLæ¥å£ï¼Œå°±æˆåŠŸåœ°ä»¥aarçš„å½¢å¼æä¾›ç»™éœ€æ±‚æ–¹ï¼Œç”±ä»–ä»¬å»ä½¿ç”¨æ•°æ®åšä¸šåŠ¡äº†ã€‚</p>
<h1 id="æ‰©å±•">æ‰©å±•</h1>
<p>æœ€åï¼Œå¦‚æœéœ€è¦æ‰©å±•æ¥å£åŠŸèƒ½ï¼Œæˆ‘ä»¬ä¸æ­¢å¯ä»¥åœ¨AIDLæ¥å£ä¸­å›è°ƒåƒintå’ŒStringè¿™ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œä¹Ÿå¯ä»¥ä¼ è¾“ä¸€ä¸ªå®ç°äº†å®ç°äº†Parcelableæ¥å£çš„å®ä½“ç±»ï¼Œè·å–å…¶ä¸­çš„å¤šæ ·åŒ–çš„å±æ€§æ•°æ®ã€‚</p>
<p>æ€»ç»“ä¸€ä¸‹å°±æ˜¯ï¼Œç®€å•éœ€æ±‚ç”¨AIDLæ¥å£åŸºæœ¬æ•°æ®ç±»å‹å°±è¶³å¤Ÿäº†ã€‚å¤§é‡æ•°æ®æˆ‘ä»¬å¯ä»¥ç”¨ç³»ç»Ÿæ•°æ®åº“çš„æ–¹å¼ä¼ è¾“JSONï¼Œæˆ–è€…ç”¨å…¨å±€çš„é”®å€¼å¯¹å­˜å‚¨å·¥å…·ï¼Œæ›´å¤§çš„éœ€æ±‚å°±å¯ä»¥å†™å…±äº«æ–‡ä»¶ï¼Œå†å‘å•æ¬¡æˆåŠŸçš„é€šçŸ¥è®©å¯¹æ–¹å»è·å–ã€‚</p>

                </div>
                <div class="clear"></div>
              </section>
            </article>
            <div class="clear"></div>

            <section class="related section">
              
              <article class="prev grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://github.com/stepheneasyshot/stepheneasyshot.github.io/post-images/android-duo-qu-dao-da-bao-pei-zhi-fang-an.jpg');"></div>
                 <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-duo-qu-dao-da-bao-pei-zhi-fang-an/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2024-06-05">2024-06-05</time>
                  <h4 class="title white no-margin">Androidå¤šæ¸ é“æ‰“åŒ…é…ç½®æ–¹æ¡ˆ</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/images/left-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              
              
              <article class="next grid-50 tablet-grid-50 grid-parent">
                <div class="thumb cover lazy loaded" style="background-image: url('https://github.com/stepheneasyshot/stepheneasyshot.github.io/post-images/hello-gridea.jpg');"></div>
                 <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/hello-gridea/" class="full-link"></a>
                 <div class="info">
                  <time datetime="2024-06-01">2024-06-01</time>
                  <h4 class="title white no-margin">ä½ å¥½ ğŸ‘  æ¬¢è¿æ¥åˆ°Stephençš„ä¸ªäººä¸»é¡µ</h4>
                </div>
                 <span class="epcl-button red">
                  <img src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/images/right-arrow.svg" width="15" alt="Left Arrow">
                </span>
                <div class="overlay"></div>
              </article>
              

                <div class="clear"></div>
            </section>

              <div class="clear"></div>
              
            
              <div id="comments" class="bg-white hosted ">
                
                  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>

<div id="gitalk-container"></div>
<div class="clear"></div>

<script>
  var gitalk = new Gitalk({
    clientID: 'Ov23lixgLaEQaGAsum3I',
    clientSecret: '9b93916755a6b8704580aa244f9fab01735829bf',
    repo: 'stephencardev.github.io',
    owner: 'StephenCarDev',
    admin: ['StephenCarDev'],
    id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
    distractionFreeMode: false  // Facebook-like distraction free mode
  })

  gitalk.render('gitalk-container')
</script>

                
                
              </div>
            

            </div>
          </div>
      </main>

          <footer id="footer" class="grid-container">
        <div class="widgets row gradient-effect">
            <div class="default-sidebar border-effect">
              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_epcl_posts_thumbs underline-effect">
                  <h4 class="widget-title title white bordered">æœ€æ–°æ–‡ç« </h4>
                  
                  
                  <article class="item post-0 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-chang-yong-diao-shi-ming-ling/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://github.com/stepheneasyshot/stepheneasyshot.github.io/post-images/android-chang-yong-diao-shi-ming-ling.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2024-06-06">2024-06-06</time>
                      <h4 class="title usmall">
                        <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-chang-yong-diao-shi-ming-ling/">Androidå¸¸ç”¨è°ƒè¯•å‘½ä»¤</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-1 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-ji-cheng-unity-de-liang-chong-fang-an-shi-zhan/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://github.com/stepheneasyshot/stepheneasyshot.github.io/post-images/android-ji-cheng-unity-de-liang-chong-fang-an-shi-zhan.jpeg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2024-06-06">2024-06-06</time>
                      <h4 class="title usmall">
                        <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-ji-cheng-unity-de-liang-chong-fang-an-shi-zhan/">Androidé›†æˆUnityçš„ä¸¤ç§æ–¹æ¡ˆå®æˆ˜</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  <article class="item post-2 post type-post status-publish format-standard has-post-thumbnail hentry">
                    <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-duo-qu-dao-da-bao-pei-zhi-fang-an/" class="thumb hover-effect">
                      <span class="fullimage cover" style="display:block;border-radius:50%;background-image: url('https://github.com/stepheneasyshot/stepheneasyshot.github.io/post-images/android-duo-qu-dao-da-bao-pei-zhi-fang-an.jpg');"></span>
                    </a>
                    <div class="info gradient-effect">
                      <time datetime="2024-06-05">2024-06-05</time>
                      <h4 class="title usmall">
                        <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/post/android-duo-qu-dao-da-bao-pei-zhi-fang-an/">Androidå¤šæ¸ é“æ‰“åŒ…é…ç½®æ–¹æ¡ˆ</a>
                      </h4>
                    </div>
                    <div class="clear"></div>
                  </article>
                  
                  
                  
                  
                  
                  
                  
                  
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="tag_cloud-2" class="widget widget_tag_cloud underline-effect">
                  <h4 class="widget-title title white bordered">æ ‡ç­¾äº‘</h4>
                  <div class="tagcloud">
                    
                      <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/tag/5yQtIxh3Hz/" class="ctag ctag-0 ctag-5yQtIxh3Hz" aria-label="">Android</a>
                    
                      <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io/tag/4tpluVFZy/" class="ctag ctag-1 ctag-4tpluVFZy" aria-label="">Gridea</a>
                    
                  </div>
                  <div class="clear"></div>
                </section>
              </div>

              <div class="grid-33 tablet-grid-50 mobile-grid-100">
                <section id="epcl_about-2" class="widget widget_epcl_about underline-effect">
                  <h4 class="widget-title title white bordered">å…³äºæˆ‘</h4>
                  <div class="avatar">
                    <a href="" class="translate-effect thumb"><span class="fullimage cover" style="background-image: url(https://github.com/stepheneasyshot/stepheneasyshot.github.io/images/avatar.png);"></span></a>
                  </div>
                  <div class="info">
                    <h4 class="title small author-name gradient-effect no-margin"><a href="">Stephen&#39;s Personal Page</a></h4>
                    <p class="founder">åœ¨è¡Œä¸­çŸ¥ï¼Œåœ¨çŸ¥ä¸­è¡Œ</p>
                    <div class="social">
                      
                        
                      
                        
                      
                        
                      
                        
                      
                        
                      
                    </div> 
                  </div>
                  <div class="clear"></div>
                  </section>
              </div>

            </div>
            <div class="clear"></div>
        </div>

        <div class="logo">
          <a href="https://github.com/stepheneasyshot/stepheneasyshot.github.io"><img src="/media/images/gridea.png" alt=""></a>
        </div>
        <p class="published border-effect">
          Â©2019 å…± 6 ç¯‡æ–‡ç« 
          <br/>
          Theme <a href="https://gridea.dev/" target="_blank">ã€Œbreekã€</a> Powered by <a href="https://gridea.dev/" target="_blank">ã€ŒGrideaã€</a>
        </p>
        
        <a href="javascript:void(0)" id="back-to-top" class="epcl-button dark" style="display:none">
          <i class="fa fa-arrow"></i>
        </a>
    </footer>
    
    <div class="clear"></div>

        

      
    <script src="https://github.com/stepheneasyshot/stepheneasyshot.github.io/media/js/functions-post.js"></script>

    </div>
    <!-- end: #wrapper -->
  </body>
</html>
